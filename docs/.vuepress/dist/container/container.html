<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.46">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>note</title><meta name="description" content="打怪升级之旅~">
    <link rel="modulepreload" href="/assets/app.8347a01d.js"><link rel="modulepreload" href="/assets/container.html.6b2297ca.js"><link rel="modulepreload" href="/assets/container.html.f3b8a00a.js"><link rel="prefetch" href="/assets/index.html.4ac7edf5.js"><link rel="prefetch" href="/assets/double-pointer.html.4506dc5f.js"><link rel="prefetch" href="/assets/Go.html.aa3dd5ff.js"><link rel="prefetch" href="/assets/Python.html.158dfc2f.js"><link rel="prefetch" href="/assets/Web-for-Go.html.286f81db.js"><link rel="prefetch" href="/assets/kubespray.html.90c74a2e.js"><link rel="prefetch" href="/assets/CSS.html.88376f10.js"><link rel="prefetch" href="/assets/Echarts.html.23f6be67.js"><link rel="prefetch" href="/assets/JavaScript.html.94cd05a7.js"><link rel="prefetch" href="/assets/Vue.html.442bd77b.js"><link rel="prefetch" href="/assets/VuePress.html.f460c07a.js"><link rel="prefetch" href="/assets/浏览器原生绘图.html.3daa08cc.js"><link rel="prefetch" href="/assets/Bash.html.b82dfd98.js"><link rel="prefetch" href="/assets/404.html.93146c89.js"><link rel="prefetch" href="/assets/index.html.4228deb5.js"><link rel="prefetch" href="/assets/double-pointer.html.44d7feee.js"><link rel="prefetch" href="/assets/Go.html.fccaaba3.js"><link rel="prefetch" href="/assets/Python.html.e1d8aaf1.js"><link rel="prefetch" href="/assets/Web-for-Go.html.77bfcade.js"><link rel="prefetch" href="/assets/kubespray.html.07385805.js"><link rel="prefetch" href="/assets/CSS.html.cfe0eaba.js"><link rel="prefetch" href="/assets/Echarts.html.2becf048.js"><link rel="prefetch" href="/assets/JavaScript.html.cdf37f05.js"><link rel="prefetch" href="/assets/Vue.html.06b42507.js"><link rel="prefetch" href="/assets/VuePress.html.f2ad32ff.js"><link rel="prefetch" href="/assets/浏览器原生绘图.html.8865a64f.js"><link rel="prefetch" href="/assets/Bash.html.4dbcc991.js"><link rel="prefetch" href="/assets/404.html.44c5ffec.js"><link rel="prefetch" href="/assets/404.85ae2861.js"><link rel="prefetch" href="/assets/Layout.a81f8cb3.js"><link rel="prefetch" href="/assets/Home.c9fdb934.js">
    <link rel="stylesheet" href="/assets/style.3c0c178b.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">note</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="运维"><span class="title">运维</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="运维"><span class="title">运维</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Linux基础</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ops/Bash" class="" aria-label="Bash"><!--[--><!--]--> Bash <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端基础</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/frontend/css" class="" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/javascript" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>工程化</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/frontend/vue" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>可视化</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/frontend/浏览器原生绘图.html" class="" aria-label="浏览器原生绘图"><!--[--><!--]--> 浏览器原生绘图 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/echarts" class="" aria-label="Apache Echarts"><!--[--><!--]--> Apache Echarts <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="后端"><span class="title">后端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="后端"><span class="title">后端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Python</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/backend/Python" class="" aria-label="Python核心语法"><!--[--><!--]--> Python核心语法 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Go</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/backend/Go" class="" aria-label="Go核心语法"><!--[--><!--]--> Go核心语法 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/backend/Web-for-Go" class="" aria-label="Go Web开发"><!--[--><!--]--> Go Web开发 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="容器"><span class="title">容器</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="容器"><span class="title">容器</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>容器基础</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/container/container" class="router-link-active" aria-label="容器核心技术"><!--[--><!--]--> 容器核心技术 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>容器编排工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/container/kubespray" class="" aria-label="使用kubespray部署k8s"><!--[--><!--]--> 使用kubespray部署k8s <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>通用算法</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/algorithm/double-pointer" class="" aria-label="双指针"><!--[--><!--]--> 双指针 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/VVFock3r/Notes" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="运维"><span class="title">运维</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="运维"><span class="title">运维</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Linux基础</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ops/Bash" class="" aria-label="Bash"><!--[--><!--]--> Bash <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="前端"><span class="title">前端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="前端"><span class="title">前端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端基础</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/frontend/css" class="" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/javascript" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>工程化</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/frontend/vue" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>可视化</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/frontend/浏览器原生绘图.html" class="" aria-label="浏览器原生绘图"><!--[--><!--]--> 浏览器原生绘图 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/echarts" class="" aria-label="Apache Echarts"><!--[--><!--]--> Apache Echarts <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="后端"><span class="title">后端</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="后端"><span class="title">后端</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Python</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/backend/Python" class="" aria-label="Python核心语法"><!--[--><!--]--> Python核心语法 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Go</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/backend/Go" class="" aria-label="Go核心语法"><!--[--><!--]--> Go核心语法 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/backend/Web-for-Go" class="" aria-label="Go Web开发"><!--[--><!--]--> Go Web开发 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="容器"><span class="title">容器</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="容器"><span class="title">容器</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>容器基础</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/container/container" class="router-link-active" aria-label="容器核心技术"><!--[--><!--]--> 容器核心技术 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>容器编排工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/container/kubespray" class="" aria-label="使用kubespray部署k8s"><!--[--><!--]--> 使用kubespray部署k8s <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="算法"><span class="title">算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="算法"><span class="title">算法</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>通用算法</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/algorithm/double-pointer" class="" aria-label="双指针"><!--[--><!--]--> 双指针 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/VVFock3r/Notes" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/container/container.html#容器" class="router-link-active router-link-exact-active sidebar-item" aria-label="容器"><!--[--><!--]--> 容器 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/container/container.html#容器核心技术" class="router-link-active router-link-exact-active sidebar-item" aria-label="容器核心技术"><!--[--><!--]--> 容器核心技术 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#容器平台技术" class="router-link-active router-link-exact-active sidebar-item" aria-label="容器平台技术"><!--[--><!--]--> 容器平台技术 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#faq" class="router-link-active router-link-exact-active sidebar-item" aria-label="FAQ"><!--[--><!--]--> FAQ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/container/container.html#" class="router-link-active router-link-exact-active sidebar-item" aria-label><!--[--><!--]-->  <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#docker-engine" class="router-link-active router-link-exact-active sidebar-item" aria-label="Docker Engine"><!--[--><!--]--> Docker Engine <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/container/container.html#基础操作" class="router-link-active router-link-exact-active sidebar-item" aria-label="基础操作"><!--[--><!--]--> 基础操作 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/container/container.html#安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="安装"><!--[--><!--]--> 安装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#运行容器" class="router-link-active router-link-exact-active sidebar-item" aria-label="运行容器"><!--[--><!--]--> 运行容器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#设置名称" class="router-link-active router-link-exact-active sidebar-item" aria-label="设置名称"><!--[--><!--]--> 设置名称 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#进入容器" class="router-link-active router-link-exact-active sidebar-item" aria-label="进入容器"><!--[--><!--]--> 进入容器 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#重启策略" class="router-link-active router-link-exact-active sidebar-item" aria-label="重启策略"><!--[--><!--]--> 重启策略 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#自动删除" class="router-link-active router-link-exact-active sidebar-item" aria-label="自动删除"><!--[--><!--]--> 自动删除 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/container/container.html#docker镜像" class="router-link-active router-link-exact-active sidebar-item" aria-label="Docker镜像"><!--[--><!--]--> Docker镜像 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/container/container.html#修改镜像源" class="router-link-active router-link-exact-active sidebar-item" aria-label="修改镜像源"><!--[--><!--]--> 修改镜像源 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#镜像的分层结构" class="router-link-active router-link-exact-active sidebar-item" aria-label="镜像的分层结构"><!--[--><!--]--> 镜像的分层结构 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#镜像导出和导入" class="router-link-active router-link-exact-active sidebar-item" aria-label="镜像导出和导入"><!--[--><!--]--> 镜像导出和导入 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#dockerfile-1-简介和常用指令" class="router-link-active router-link-exact-active sidebar-item" aria-label="Dockerfile(1):简介和常用指令"><!--[--><!--]--> Dockerfile(1):简介和常用指令 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#dockerfile-2-cmd和entrypoint" class="router-link-active router-link-exact-active sidebar-item" aria-label="Dockerfile(2):CMD和ENTRYPOINT"><!--[--><!--]--> Dockerfile(2):CMD和ENTRYPOINT <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#dockerfile-3-多阶段构建优化go项目" class="router-link-active router-link-exact-active sidebar-item" aria-label="Dockerfile(3):多阶段构建优化Go项目"><!--[--><!--]--> Dockerfile(3):多阶段构建优化Go项目 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/container/container.html#docker存储" class="router-link-active router-link-exact-active sidebar-item" aria-label="Docker存储"><!--[--><!--]--> Docker存储 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/container/container.html#持久化方式1-bind-mounts" class="router-link-active router-link-exact-active sidebar-item" aria-label="持久化方式1：bind mounts"><!--[--><!--]--> 持久化方式1：bind mounts <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#持久化方式2-volumes" class="router-link-active router-link-exact-active sidebar-item" aria-label="持久化方式2：volumes"><!--[--><!--]--> 持久化方式2：volumes <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#内存文件系统-tmpfs-mounts" class="router-link-active router-link-exact-active sidebar-item" aria-label="内存文件系统：tmpfs mounts"><!--[--><!--]--> 内存文件系统：tmpfs mounts <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/container/container.html#docker资源限制" class="router-link-active router-link-exact-active sidebar-item" aria-label="Docker资源限制"><!--[--><!--]--> Docker资源限制 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/container/container.html#内存限制" class="router-link-active router-link-exact-active sidebar-item" aria-label="内存限制"><!--[--><!--]--> 内存限制 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#cpu限制" class="router-link-active router-link-exact-active sidebar-item" aria-label="CPU限制"><!--[--><!--]--> CPU限制 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/container/container.html#docker网络" class="router-link-active router-link-exact-active sidebar-item" aria-label="Docker网络"><!--[--><!--]--> Docker网络 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/container/container.html#docker自带的3种网络" class="router-link-active router-link-exact-active sidebar-item" aria-label="Docker自带的3种网络"><!--[--><!--]--> Docker自带的3种网络 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#_1-none网络" class="router-link-active router-link-exact-active sidebar-item" aria-label="（1）none网络"><!--[--><!--]--> （1）none网络 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#_2-host网络" class="router-link-active router-link-exact-active sidebar-item" aria-label="（2）host网络"><!--[--><!--]--> （2）host网络 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#_3-container网络" class="router-link-active router-link-exact-active sidebar-item" aria-label="（3）container网络"><!--[--><!--]--> （3）container网络 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#_4-1-默认bridge网络" class="router-link-active router-link-exact-active sidebar-item" aria-label="（4-1）默认bridge网络"><!--[--><!--]--> （4-1）默认bridge网络 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#_4-2-自定义bridge网络" class="router-link-active router-link-exact-active sidebar-item" aria-label="（4-2）自定义bridge网络"><!--[--><!--]--> （4-2）自定义bridge网络 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#_4-3-自定义bridge与默认的区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="（4-3）自定义bridge与默认的区别"><!--[--><!--]--> （4-3）自定义bridge与默认的区别 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#_4-4-不同bridge下的容器互通" class="router-link-active router-link-exact-active sidebar-item" aria-label="（4-4）不同bridge下的容器互通"><!--[--><!--]--> （4-4）不同bridge下的容器互通 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/container/container.html#_4-5-修改默认的bridge" class="router-link-active router-link-exact-active sidebar-item" aria-label="（4-5）修改默认的bridge"><!--[--><!--]--> （4-5）修改默认的bridge <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h2 id="容器" tabindex="-1"><a class="header-anchor" href="#容器" aria-hidden="true">#</a> 容器</h2><h3 id="容器核心技术" tabindex="-1"><a class="header-anchor" href="#容器核心技术" aria-hidden="true">#</a> 容器核心技术</h3><p><strong>容器的本质</strong></p><p>容器本质上是一个特殊的进程，使用Linux Namespace对资源进行隔离、cgroup对资源进行限制。</p><br><p><strong><code>OCI</code>组织</strong></p><p>2015年6月22由<code>Docker</code>、<code>CoreOS</code>和其他公司共同成立了一个叫<code>Open Container Initiative</code>的组织（简称<code>OCI</code>）,其目的是制定开放的容器规范。</p><p>官网：<a href="https://opencontainers.org/" target="_blank" rel="noopener noreferrer">https://opencontainers.org/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，Github：<a href="https://github.com/opencontainers" target="_blank" rel="noopener noreferrer">https://github.com/opencontainers<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><code>OCI</code>目前发布了三个规范：运行时规范（<code>Runtime spec</code>）、镜像规范（<code>Image spec</code>）和分发规范（<code>distribution-spec</code>）</p><br><p><strong>运行时说明</strong></p><p>（1）容器运行时规范</p><p>容器运行时规范描述了<span style="color:red;font-weight:bold;">容器的配置、运行环境和生命周期</span></p><p>（2）容器运行时</p><p>容器运行时（<code>runtime</code>）是容器真正运行的地方，<code>lxc</code>、<code>runc</code>、<code>rkt</code>是目前主流的三种容器runtime</p><p><code>lxc</code>是Linux上老牌的运行时。Docker最初也是使用<code>lxc</code>作为容器runtime</p><p><code>runc</code>是Docker自己开发的运行时，符合OCI规范，也是现在Docker默认的runtime</p><p><code>rkt</code>是CoreOS开发的容器runtime，符合OCI规范，因此能够运行Docker容器</p><p>（3）容器运行时管理工具</p><p>光有运行时还不够，用户得有工具管理容器</p><p>lxc的管理工具是<code>lxd</code></p><p>runc的管理工具是<code>docker engine</code>，<code>docker engine</code>包含deamon和cli两部分。我们通常提到的Docker，一般就是指<code>docker engine</code></p><p>rkt的管理工具是<code>rkt cli</code></p><br><p><strong>镜像说明</strong></p><p>（1）容器镜像规范</p><p>容器镜像规范定义一个OCI镜像由<code>a manifest</code>、<code> an image index</code>（可选）、<code>a set of filesystem layers</code>和<code>a Configuration</code>组成。</p><p>（2）容器镜像</p><p>容器镜像是用来创建容器的，runtime依据容器镜像来创建容器</p><p>最常用的Docker镜像是符合OCI Image规范的</p><p>（3）容器镜像定义工具</p><p>容器定义工具允许用户自定义容器的内容和属性，这样容器就能够被保存、共享和创建</p><p>dockerfile是包含若干命令的文本文件，可以通过这些命令创建出docker镜像</p><p>（4）容器镜像存储仓库</p><p>镜像需要统一存储，这个存储的大的仓库叫做Registry。<code>Docker Hub</code>和<code>Quay.io</code>是为公众提供托管的Registry，我们一般使用<code>Harbor</code>来搭建私有的Registry</p><br><h3 id="容器平台技术" tabindex="-1"><a class="header-anchor" href="#容器平台技术" aria-hidden="true">#</a> 容器平台技术</h3><p>容器核心技术可以让容器运行在单个主机上，而容器平台技术可以让容器运行在分布式环境中</p><br><p><strong>容器编排引擎</strong></p><p>所谓编排，通常包括容器管理、调度、集群定义和服务发现等。</p><p><code>docker swarm</code>是Docker开发的容器编排引擎</p><p><code>kubernetes</code>是Google开发的开源容器编排引擎，同时支持Docker和CoreOS容器</p><br><p><strong>容器管理平台</strong></p><p>容器管理平台是架构在容器编排引擎之上的一个更为通用的平台，通常容器管理平台可以支持多种编排引擎</p><p><code>Rancher</code>是容器管理平台的典型代表</p><br><h3 id="faq" tabindex="-1"><a class="header-anchor" href="#faq" aria-hidden="true">#</a> FAQ</h3><h2 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h2><h2 id="docker-engine" tabindex="-1"><a class="header-anchor" href="#docker-engine" aria-hidden="true">#</a> Docker Engine</h2><p>官网：<a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer">https://www.docker.com/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="基础操作" tabindex="-1"><a class="header-anchor" href="#基础操作" aria-hidden="true">#</a> 基础操作</h3><h4 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h4><p>CentOS安装文档：<a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/engine/install/centos/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><details class="custom-container details"><summary>点击查看详情</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 卸载老版本(如果有)</span>
<span class="token function">sudo</span> yum remove <span class="token function">docker</span> <span class="token punctuation">\</span>
                  docker-client <span class="token punctuation">\</span>
                  docker-client-latest <span class="token punctuation">\</span>
                  docker-common <span class="token punctuation">\</span>
                  docker-latest <span class="token punctuation">\</span>
                  docker-latest-logrotate <span class="token punctuation">\</span>
                  docker-logrotate <span class="token punctuation">\</span>
                  docker-engine

<span class="token comment"># 安装Docker仓库</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils
<span class="token function">sudo</span> yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
    
<span class="token comment"># 查看docker-ce所有可安装版本（Docker CE是Docker免费版产品的新名称）</span>
yum list docker-ce --showduplicates
 * updates: mirrors.tuna.tsinghua.edu.cn
Loading mirror speeds from cached hostfile
Loaded plugins: fastestmirror
 * extras: mirrors.tuna.tsinghua.edu.cn
<span class="token punctuation">..</span>.
docker-ce.x86_64          <span class="token number">3</span>:20.10.2-3.el7           docker-ce-stable
docker-ce.x86_64          <span class="token number">3</span>:20.10.3-3.el7           docker-ce-stable
docker-ce.x86_64          <span class="token number">3</span>:20.10.4-3.el7           docker-ce-stable
docker-ce.x86_64          <span class="token number">3</span>:20.10.5-3.el7           docker-ce-stable
docker-ce.x86_64          <span class="token number">3</span>:20.10.6-3.el7           docker-ce-stable
docker-ce.x86_64          <span class="token number">3</span>:20.10.7-3.el7           docker-ce-stable
docker-ce.x86_64          <span class="token number">3</span>:20.10.8-3.el7           docker-ce-stable
docker-ce.x86_64          <span class="token number">3</span>:20.10.9-3.el7           docker-ce-stable
docker-ce.x86_64          <span class="token number">3</span>:20.10.10-3.el7          docker-ce-stable
docker-ce.x86_64          <span class="token number">3</span>:20.10.11-3.el7          docker-ce-stable
docker-ce.x86_64          <span class="token number">3</span>:20.10.12-3.el7          docker-ce-stable
docker-ce.x86_64          <span class="token number">3</span>:20.10.13-3.el7          docker-ce-stable
docker-ce.x86_64          <span class="token number">3</span>:20.10.14-3.el7          docker-ce-stable
docker-ce.x86_64          <span class="token number">3</span>:20.10.15-3.el7          docker-ce-stable	<span class="token comment"># 这里是最新的</span>

<span class="token comment"># 安装最新版</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce docker-ce-cli containerd.io docker-compose-plugin

<span class="token comment"># 安装指定版本</span>
<span class="token comment"># 语法：sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io docker-compose-plugin</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce-20.10.14 docker-ce-cli-20.10.14 containerd.io docker-compose-plugin

<span class="token comment"># 启动Docker Engine</span>
<span class="token function">sudo</span> systemctl start docker.service
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> docker.service	<span class="token comment"># 设置开启自启</span>

<span class="token comment"># 测试Docker Engine</span>
<span class="token function">sudo</span> <span class="token function">docker</span> run hello-world
</code></pre></div></details><h4 id="运行容器" tabindex="-1"><a class="header-anchor" href="#运行容器" aria-hidden="true">#</a> 运行容器</h4><details class="custom-container details"><summary>运行容器示例</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 语法</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --help | head -5</span>
Usage:  <span class="token function">docker</span> container run <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> IMAGE <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARG<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
Run a <span class="token builtin class-name">command</span> <span class="token keyword">in</span> a new container

<span class="token comment"># 运行一个容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run centos:7</span>

<span class="token comment"># 状态为Exited(0)，意思是容器正常运行完后就退出了，容器运行的命令是/bin/bash</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps -a</span>
CONTAINER ID   IMAGE      COMMAND       CREATED          STATUS                      PORTS     NAMES
e94332164c56   centos:7   <span class="token string">&quot;/bin/bash&quot;</span>   <span class="token number">41</span> seconds ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">41</span> seconds ago             vigilant_sanderson

<span class="token comment"># 怎么能让它不退出呢？</span>
</code></pre></div></details><details class="custom-container details"><summary>容器不退出方式一：前台进程</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 方式一：</span>
<span class="token comment"># 容器本质就是一个进程，进程执行完毕自然就退出了，所以容器也自然就退出了，不让容器退出的办法之一就是启动一个不会退出的进程，</span>
<span class="token comment"># 比如像nginx等服务就是想办法让他在前台运行不退出</span>
<span class="token comment"># 在这里我们使用一个自定义的命令替换掉/bin/bash</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run centos:7 sleep 100</span>

<span class="token comment"># 另外开一个终端查看容器信息</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps </span>
CONTAINER ID   IMAGE      COMMAND       CREATED          STATUS         PORTS     NAMES
2c2af2267d37   centos:7   <span class="token string">&quot;sleep 100&quot;</span>   <span class="token number">10</span> seconds ago   Up <span class="token number">8</span> seconds             recursing_ride
<span class="token comment"># ---------------------------------------------------------------------------------------------------</span>
<span class="token comment"># 如果说容器里我们运行一个nginx，那么就像这样</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run nginx:1.21.6</span>
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking <span class="token keyword">for</span> shell scripts <span class="token keyword">in</span> /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
<span class="token number">10</span>-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
<span class="token number">10</span>-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 <span class="token keyword">in</span> /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete<span class="token punctuation">;</span> ready <span class="token keyword">for</span> start up
<span class="token number">2022</span>/05/12 05:48:15 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: using the &quot;epoll&quot; event method</span>
<span class="token number">2022</span>/05/12 05:48:15 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: nginx/1.21.6</span>
<span class="token number">2022</span>/05/12 05:48:15 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6) </span>
<span class="token number">2022</span>/05/12 05:48:15 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: OS: Linux 3.10.0-693.el7.x86_64</span>
<span class="token number">2022</span>/05/12 05:48:15 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: getrlimit(RLIMIT_NOFILE): 65536:65536</span>
<span class="token number">2022</span>/05/12 05:48:15 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker processes</span>
<span class="token number">2022</span>/05/12 05:48:15 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 31</span>
<span class="token number">2022</span>/05/12 05:48:15 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 32</span>
<span class="token number">2022</span>/05/12 05:48:15 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 33</span>
<span class="token number">2022</span>/05/12 05:48:15 <span class="token punctuation">[</span>notice<span class="token punctuation">]</span> <span class="token number">1</span><span class="token comment">#1: start worker process 34</span>

<span class="token comment"># 另外开一个终端查看容器信息</span>
<span class="token comment"># nginx -g &#39;daemon off;&#39;就是nginx在前台运行的命令</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps --no-trunc</span>
CONTAINER ID                                                       IMAGE          COMMAND                                          CREATED              STATUS              PORTS     NAMES
864381465f51c5b88eb4c11ec78d0cf10593ea8a5f56795698fe5686129cab22   nginx:1.21.6   <span class="token string">&quot;/docker-entrypoint.sh nginx -g &#39;daemon off;&#39;&quot;</span>   <span class="token number">34</span> seconds ago       Up <span class="token number">34</span> seconds       <span class="token number">80</span>/tcp    brave_wilbur
</code></pre></div></details><details class="custom-container details"><summary>容器不退出方式二：开启标准输入hang住容器</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 方式二：</span>
<span class="token comment"># 使用docker container run -i选项，开启标准输入功能，这会hang住容器，让容器不退出</span>
<span class="token comment">#（注意不是任何程序都支持输入功能，比如/bin/bash和cat是支持的，ls就不支持）</span>

<span class="token comment"># /bin/bash开启输入功能，支持</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -i centos:7 </span>
<span class="token function">ls</span> -l			<span class="token comment"># 这里可以输入命令</span>
total <span class="token number">12</span>
-rw-r--r--.   <span class="token number">1</span> root root <span class="token number">12114</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> anaconda-post.log
lrwxrwxrwx.   <span class="token number">1</span> root root     <span class="token number">7</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> bin -<span class="token operator">&gt;</span> usr/bin
drwxr-xr-x.   <span class="token number">5</span> root root   <span class="token number">340</span> May <span class="token number">12</span> 05:16 dev
drwxr-xr-x.   <span class="token number">1</span> root root    <span class="token number">66</span> May <span class="token number">12</span> 05:16 etc
drwxr-xr-x.   <span class="token number">2</span> root root     <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> home
lrwxrwxrwx.   <span class="token number">1</span> root root     <span class="token number">7</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> lib -<span class="token operator">&gt;</span> usr/lib
lrwxrwxrwx.   <span class="token number">1</span> root root     <span class="token number">9</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> lib64 -<span class="token operator">&gt;</span> usr/lib64
drwxr-xr-x.   <span class="token number">2</span> root root     <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> media
drwxr-xr-x.   <span class="token number">2</span> root root     <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> mnt
drwxr-xr-x.   <span class="token number">2</span> root root     <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> opt
dr-xr-xr-x. <span class="token number">204</span> root root     <span class="token number">0</span> May <span class="token number">12</span> 05:16 proc
dr-xr-x---.   <span class="token number">2</span> root root   <span class="token number">114</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> root
drwxr-xr-x.  <span class="token number">11</span> root root   <span class="token number">148</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> run
lrwxrwxrwx.   <span class="token number">1</span> root root     <span class="token number">8</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> sbin -<span class="token operator">&gt;</span> usr/sbin
drwxr-xr-x.   <span class="token number">2</span> root root     <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> srv
dr-xr-xr-x.  <span class="token number">13</span> root root     <span class="token number">0</span> May <span class="token number">12</span> 00:33 sys
drwxrwxrwt.   <span class="token number">7</span> root root   <span class="token number">132</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> tmp
drwxr-xr-x.  <span class="token number">13</span> root root   <span class="token number">155</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> usr
drwxr-xr-x.  <span class="token number">18</span> root root   <span class="token number">238</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> var
<span class="token builtin class-name">pwd</span>			<span class="token comment"># 这里可以输入命令</span>
/

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE      COMMAND       CREATED         STATUS         PORTS     NAMES
529a4f7bd34a   centos:7   <span class="token string">&quot;/bin/bash&quot;</span>   <span class="token number">4</span> seconds ago   Up <span class="token number">4</span> seconds             dreamy_euler

<span class="token comment"># cat开启输入功能，支持</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -i centos:7 cat</span>
hello		<span class="token comment"># 我输入的</span>
hello
world<span class="token operator">!</span>		<span class="token comment"># 我输入的</span>
world<span class="token operator">!</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE      COMMAND   CREATED          STATUS          PORTS     NAMES
58704e3b1ad7   centos:7   <span class="token string">&quot;cat&quot;</span>     <span class="token number">27</span> seconds ago   Up <span class="token number">26</span> seconds             thirsty_sammet

<span class="token comment"># ls开启输入功能，不支持</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -i centos:7 ls</span>
anaconda-post.log
bin
dev
etc
home
lib
lib64
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
</code></pre></div></details><details class="custom-container details"><summary>容器不退出辅助命令</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 优化1：添加-t参数，意思是为我们分配一个伪终端tty,通常-it这两个参数一起用</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -it centos:7</span>
<span class="token punctuation">[</span>root@ed41df8e2e3b /<span class="token punctuation">]</span><span class="token comment"># hostname</span>
ed41df8e2e3b

<span class="token comment"># 优化2：使用-d参数，意思是以后台方式运行容器并返回容器的ID</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -itd centos:7		# -it用来hang住容器</span>
d06b76d850c934bfe02785bbd52045694b238f6d40677d1f8eebf7738c07e718

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -d nginx:1.21.6	# nginx镜像不需要hang住容器，所以可以不用加-it</span>
00b757bf7358ea24b7b17a0f775f3aadb29d268f531d7a87c373747a07cbb3e3
</code></pre></div></details><h4 id="设置名称" tabindex="-1"><a class="header-anchor" href="#设置名称" aria-hidden="true">#</a> 设置名称</h4><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 默认Docker会随机分配名称给新创建的，这时候我们可以手动指定一个名称</span>
<span class="token comment"># 好处是以后操作容器时可以使用我们指定的名称，更加方便，而不是使用Container ID或随机名称</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -itd --name mycentos centos:7</span>
c873d90fc350e4218779addc24be5309948010058e397bfd2b4f3845f114d237

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE      COMMAND       CREATED              STATUS              PORTS     NAMES
c873d90fc350   centos:7   <span class="token string">&quot;/bin/bash&quot;</span>   About a minute ago   Up About a minute             mycentos <span class="token comment"># 我们指定的名称</span>

<span class="token comment"># 给容器内的centos系统设置一个主机名，并运行hostname命令（替换默认的/bin/bash）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -it --name webserver --hostname node1 centos:7 hostname</span>
node1
</code></pre></div><h4 id="进入容器" tabindex="-1"><a class="header-anchor" href="#进入容器" aria-hidden="true">#</a> 进入容器</h4><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># exec子命令：在容器中运行指定的命令，在这里我们执行的命令是sh，并添加-it，hang住容器</span>
<span class="token comment"># 就等同于变相的进入了容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -itd centos:7 </span>
7f8576596e250e160f991e38852f9350a12fc244a52563a2a39ef968f375e799
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it 7f8576 sh</span>
sh-4.2<span class="token comment"># ps aux</span>
<span class="token environment constant">USER</span>        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root          <span class="token number">1</span>  <span class="token number">0.2</span>  <span class="token number">0.0</span>  <span class="token number">11828</span>  <span class="token number">1652</span> pts/0    Ss+  06:12   <span class="token number">0</span>:00 /bin/bash		<span class="token comment"># 这是hang住容器的那个进程</span>
root         <span class="token number">14</span>  <span class="token number">0.3</span>  <span class="token number">0.0</span>  <span class="token number">11824</span>  <span class="token number">1656</span> pts/1    Ss   06:12   <span class="token number">0</span>:00 <span class="token function">sh</span>			<span class="token comment"># 这是我们新开的进程sh</span>
root         <span class="token number">20</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>  <span class="token number">51732</span>  <span class="token number">1700</span> pts/1    R+   06:12   <span class="token number">0</span>:00 <span class="token function">ps</span> aux		<span class="token comment"># 刚才执行的命令</span>
sh-4.2<span class="token comment"># </span>

<span class="token comment"># attach子命令：直接进入启动容器的终端，不会启动新的进程</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker attach 7f8576</span>
<span class="token punctuation">[</span>root@7f8576596e25 /<span class="token punctuation">]</span><span class="token comment"># ps aux</span>
<span class="token environment constant">USER</span>        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root          <span class="token number">1</span>  <span class="token number">0.1</span>  <span class="token number">0.0</span>  <span class="token number">11828</span>  <span class="token number">1880</span> pts/0    Ss   06:17   <span class="token number">0</span>:00 /bin/bash		<span class="token comment"># 直接进入到这个终端中</span>
root         <span class="token number">15</span>  <span class="token number">0.0</span>  <span class="token number">0.0</span>  <span class="token number">51732</span>  <span class="token number">1704</span> pts/0    R+   06:17   <span class="token number">0</span>:00 <span class="token function">ps</span> aux
<span class="token comment"># 这时候如果我们使用Ctrl+D或exit命令退出，会导致容器退出</span>
<span class="token punctuation">[</span>root@6dc924686c87 /<span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre></div><h4 id="重启策略" tabindex="-1"><a class="header-anchor" href="#重启策略" aria-hidden="true">#</a> 重启策略</h4><p>文档：<a href="https://docs.docker.com/engine/reference/run/#restart-policies---restart" target="_blank" rel="noopener noreferrer">https://docs.docker.com/engine/reference/run/#restart-policies---restart<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><code>docker container run</code>创建容器时可以指定容器的重启策略，意思是当容器关闭时是否自动重启</p><p><strong>重启策略</strong></p><table><thead><tr><th>策略</th><th>说明</th></tr></thead><tbody><tr><td>no</td><td>不自动重启（默认策略）</td></tr><tr><td>always</td><td>退出码不为0时自动重启；<br>当重启docker daemon后若容器为停止状态则会自动重启容器</td></tr><tr><td>unless-stopped</td><td>退出码不为0时自动重启；<br>当重启docker daemon后若容器为停止状态不会自动重启容器</td></tr><tr><td>on-failure[:max-retries]</td><td>退出码不为0时自动重启；max-retries是可选参数，最多重启次数</td></tr></tbody></table><p><strong>退出状态码</strong></p><table><thead><tr><th>状态码</th><th>说明</th></tr></thead><tbody><tr><td>0</td><td>容器正常退出</td></tr><tr><td>125</td><td>Docker daemon进程错误</td></tr><tr><td>126</td><td>容器启动后要执行的命令无法调用</td></tr><tr><td>127</td><td>容器启动后要执行的命令无法找到</td></tr><tr><td>其他状态码</td><td>容器启动后执行的命令退出码</td></tr></tbody></table><p><span style="color:red;font-weight:bold;">重要提示：</span></p><ul><li><span style="color:red;font-weight:bold;">当退出码为0时，任何重启策略都不会重启容器</span></li><li><span style="color:red;font-weight:bold;">docker container stop关闭的容器退出码为0</span></li></ul><details class="custom-container details"><summary>查看容器的重启策略信息</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 随便启动一个容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo centos:7 echo $(date +&quot;%F&quot;)</span>
<span class="token number">2022</span>-05-12

<span class="token comment"># 查看状态</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo | grep -A 13 State</span>
        <span class="token string">&quot;State&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Status&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;exited&quot;</span>,		<span class="token comment"># 容器状态</span>
            <span class="token string">&quot;Running&quot;</span><span class="token builtin class-name">:</span> false,		<span class="token comment"># 是否正在运行</span>
            <span class="token string">&quot;Paused&quot;</span><span class="token builtin class-name">:</span> false,		
            <span class="token string">&quot;Restarting&quot;</span><span class="token builtin class-name">:</span> false,
            <span class="token string">&quot;OOMKilled&quot;</span><span class="token builtin class-name">:</span> false,
            <span class="token string">&quot;Dead&quot;</span><span class="token builtin class-name">:</span> false,
            <span class="token string">&quot;Pid&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">&quot;ExitCode&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,			<span class="token comment"># 退出码</span>
            <span class="token string">&quot;Error&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
            <span class="token string">&quot;StartedAt&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2022-05-12T07:44:42.871097747Z&quot;</span>,	<span class="token comment"># 容器开始运行时间</span>
            <span class="token string">&quot;FinishedAt&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2022-05-12T07:44:42.882166096Z&quot;</span>	<span class="token comment"># 容器结束运行时间</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;Image&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;sha256:eeb6ee3f44bd0b5103bb561b4c16bcb82328cfe5809ab675bb17ab3a16c517c9&quot;</span>,
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo -f &quot;{{ .State.Status }}&quot;	# 想看某一个值的话可以使用Go模板语法</span>
exited

<span class="token comment"># 查看重启次数</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo -f &quot;{{ .RestartCount }}&quot;</span>
<span class="token number">0</span>
</code></pre></div></details><details class="custom-container details"><summary>always重启策略</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 启动一个容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name webserver -P -d --restart=always nginx:1.21.6</span>

<span class="token comment"># 查看容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                                     NAMES
6d463a44eedc   nginx:1.21.6   <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   <span class="token number">4</span> seconds ago   Up <span class="token number">3</span> seconds   <span class="token number">0.0</span>.0.0:49153-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::49153-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   webserver

<span class="token comment"># -----------------------------------------------------------------------------------------------</span>

<span class="token comment"># 停止容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container stop webserver</span>
webserver

<span class="token comment"># 查看是否自动重启了：没有自动重启</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
<span class="token comment"># 查看退出码</span>
<span class="token comment"># 使用docker container stop停止的容器，退出码为0，即使设置always也不会自动重启</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver -f &quot;{{ .State.ExitCode }}&quot;</span>
<span class="token number">0</span>

<span class="token comment"># 重启一下Docker Engine</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker.service</span>

<span class="token comment"># 查看容器，自动重启了</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS          PORTS                                     NAMES
6d463a44eedc   nginx:1.21.6   <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   <span class="token number">3</span> minutes ago   Up <span class="token number">13</span> seconds   <span class="token number">0.0</span>.0.0:49153-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::49153-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   webserver

<span class="token comment"># 查看重启次数</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver -f &quot;{{ .RestartCount }}&quot;</span>
<span class="token number">0</span>

<span class="token comment"># -----------------------------------------------------------------------------------------------</span>

<span class="token comment"># 手动kill掉</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver -f &quot;{{ .State.Pid }}&quot;</span>
<span class="token number">35940</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># kill -15 35940</span>

<span class="token comment"># 查看容器，自动重启了</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                                     NAMES
6d463a44eedc   nginx:1.21.6   <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   <span class="token number">5</span> minutes ago   Up <span class="token number">3</span> seconds   <span class="token number">0.0</span>.0.0:49154-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::49154-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   webserver

<span class="token comment"># 查看重启次数</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver -f &quot;{{ .RestartCount }}&quot;</span>
<span class="token number">1</span>
<span class="token comment"># 检查Pid</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver -f &quot;{{ .State.Pid }}&quot;</span>
<span class="token number">36630</span>
</code></pre></div></details><details class="custom-container details"><summary>unless-stopped重启策略</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 启动一个容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name webserver -P -d --restart=unless-stopped nginx:1.21.6</span>

<span class="token comment"># 查看容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                                     NAMES
cd6c29a9928c   nginx:1.21.6   <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   <span class="token number">5</span> seconds ago   Up <span class="token number">4</span> seconds   <span class="token number">0.0</span>.0.0:49155-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::49155-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   webserver

<span class="token comment"># -----------------------------------------------------------------------------------------------</span>

<span class="token comment"># 停止容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container stop webserver</span>
webserver

<span class="token comment"># 查看是否自动重启了：没有自动重启</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
<span class="token comment"># 查看退出码</span>
<span class="token comment"># 使用docker container stop停止的容器，退出码为0，即使设置always也不会自动重启</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver -f &quot;{{ .State.ExitCode }}&quot;</span>
<span class="token number">0</span>

<span class="token comment"># 重启一下Docker Engine</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker.service</span>

<span class="token comment"># 查看容器，没有自动重启</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS          PORTS                                     NAMES

<span class="token comment"># 查看重启次数</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver -f &quot;{{ .RestartCount }}&quot;</span>
<span class="token number">0</span>
<span class="token comment"># -----------------------------------------------------------------------------------------------</span>
<span class="token comment"># 把容器起起来</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container start webserver</span>
webserver

<span class="token comment"># 手动kill掉</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver -f &quot;{{ .State.Pid }}&quot;</span>
<span class="token number">37428</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># kill -15 37428</span>

<span class="token comment"># 查看容器，自动重启了</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                                     NAMES
458b89dd302e   nginx:1.21.6   <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   <span class="token number">2</span> minutes ago   Up <span class="token number">3</span> seconds   <span class="token number">0.0</span>.0.0:49154-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::49154-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   webserver

<span class="token comment"># 查看重启次数</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver -f &quot;{{ .RestartCount }}&quot;</span>
<span class="token number">1</span>
<span class="token comment"># 检查Pid</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver -f &quot;{{ .State.Pid }}&quot;</span>
<span class="token number">37591</span>
</code></pre></div></details><details class="custom-container details"><summary>其他：构建一个自由控制退出码的镜像</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># Dockerfile</span>
<span class="token comment"># 可以通过docker container run的时候传参覆盖CMD指令来控制容器退出码</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile </span>
FROM centos:7
MAINTAINER VVFock3r
WORKDIR /

RUN <span class="token builtin class-name">echo</span> <span class="token string">&quot;#!/bin/bash&quot;</span> <span class="token operator">&gt;</span> exit.sh <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token builtin class-name">echo</span> <span class="token string">&quot;exit \<span class="token variable">$1</span>&quot;</span>   <span class="token operator">&gt;&gt;</span> exit.sh <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    <span class="token function">chmod</span> <span class="token number">755</span> exit.sh

ENTRYPOINT <span class="token punctuation">[</span><span class="token string">&quot;./exit.sh&quot;</span><span class="token punctuation">]</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">]</span>

<span class="token comment"># 构建镜像 centos:demo</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker build -t centos:demo .</span>
Sending build context to Docker daemon     16MB
Step <span class="token number">1</span>/6 <span class="token builtin class-name">:</span> FROM centos:7
 ---<span class="token operator">&gt;</span> eeb6ee3f44bd
Step <span class="token number">2</span>/6 <span class="token builtin class-name">:</span> MAINTAINER VVFock3r
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> f7cea628e420
Step <span class="token number">3</span>/6 <span class="token builtin class-name">:</span> WORKDIR /
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> 07f0b2f933b5
Step <span class="token number">4</span>/6 <span class="token builtin class-name">:</span> RUN <span class="token builtin class-name">echo</span> <span class="token string">&quot;#!/bin/bash&quot;</span> <span class="token operator">&gt;</span> exit.sh <span class="token operator">&amp;&amp;</span>     <span class="token builtin class-name">echo</span> <span class="token string">&quot;exit \<span class="token variable">$1</span>&quot;</span>   <span class="token operator">&gt;&gt;</span> exit.sh <span class="token operator">&amp;&amp;</span>     <span class="token function">chmod</span> <span class="token number">755</span> exit.sh
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> 7ba25d2264cc
Step <span class="token number">5</span>/6 <span class="token builtin class-name">:</span> ENTRYPOINT <span class="token punctuation">[</span><span class="token string">&quot;./exit.sh&quot;</span><span class="token punctuation">]</span>
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> b2385bbe65e4
Step <span class="token number">6</span>/6 <span class="token builtin class-name">:</span> CMD <span class="token punctuation">[</span><span class="token string">&quot;0&quot;</span><span class="token punctuation">]</span>
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> 268bb0cf0753
Successfully built 268bb0cf0753
Successfully tagged centos:demo

<span class="token comment"># 创建容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo -d --restart=always centos:demo 99 # 设置退出码为99</span>
</code></pre></div></details><h4 id="自动删除" tabindex="-1"><a class="header-anchor" href="#自动删除" aria-hidden="true">#</a> 自动删除</h4><p>我们可以控制容器退出后自动删除，注意与<code>--restart</code>选项互斥</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 启动3个容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run -itd --rm --name demo1 centos:7</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run -itd --rm --name demo2 centos:7</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run -itd --rm --name demo3 centos:7 ls</span>

<span class="token comment"># 停止第一个容器（退出码为0）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container stop demo1</span>

<span class="token comment"># 停止第二个容器（退出码不为0）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># kill -9 `docker container inspect demo2 -f &quot;{{ .State.Pid }}&quot;`</span>

<span class="token comment"># 第三个容器运行完成，自动会被删除</span>

<span class="token comment"># 查看容器（已全部被删除）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps -a</span>
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</code></pre></div><h3 id="docker镜像" tabindex="-1"><a class="header-anchor" href="#docker镜像" aria-hidden="true">#</a> Docker镜像</h3><h4 id="修改镜像源" tabindex="-1"><a class="header-anchor" href="#修改镜像源" aria-hidden="true">#</a> 修改镜像源</h4><p>使用Docker时需要首先下载一个官方镜像，例如<code>ubuntu</code>、<code>mysql</code>，默认会从<a href="https://hub.docker.com/" target="_blank" rel="noopener noreferrer">Docker Hub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中去下载</p><p>然而由于网络原因，下载一个Docker官方镜像可能会需要很长的时间，甚至下载失败。为此，我们可以使用国内的镜像源</p><p>腾讯云镜像源：https://mirrors.cloud.tencent.com/（点右上角【文档】，在右侧找到Docker源）</p><p>阿里云镜像源：https://help.aliyun.com/document_detail/60750.html（根据文档去控制台申请加速地址）</p><h4 id="镜像的分层结构" tabindex="-1"><a class="header-anchor" href="#镜像的分层结构" aria-hidden="true">#</a> 镜像的分层结构</h4><p>镜像其实就是一个<code>tar</code>文件，内部采用的是分层结构，每一层（Layer）存储的只是与上一层的差异，由<code>Storage Driver</code>（存储驱动程序）进行管理</p><p><code>Storage Driver</code>会把镜像中的每一层挂载为只读模式，通常称为 镜像层，当我们创建容器时，会在镜像层上加一个新的可写的分层，通常称为容器层</p><p><strong>容器层操作细节</strong></p><ul><li>添加文件：在容器中创建文件时，新的文件被添加到容器层</li><li>读取文件：在容器中读取文件时，Docker会从上往下依次在各层中查找此文件，一旦找到，打开并读入内存</li><li>修改文件：在容器中修改文件时，Docker会从上往下依次在各层中查找此文件，一旦找到，立即将其复制到容器层，然后修改之</li><li>删除文件：在容器中删除文件时，Docker会从上往下依次在各层中查找此文件，一旦找到，会在容器层中标记为已删除</li></ul><p>只有当修改时才复制一份数据，这种特性被称为<code>Copy-on-Write</code></p><p><strong>查看当前Docker Engine所使用的Storage Driver类型</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker info | grep -i storage</span>
 Storage Driver: overlay2
</code></pre></div><p><strong>查看镜像分层结构</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 方式一：下载镜像时可以看到该镜像有几个分层</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker image pull nginx:1.21.6</span>
Using default tag: latest
latest: Pulling from library/nginx
1fe172e4850f: Pull complete
35c195f487df: Pull complete
213b9b16f495: Pull complete
a8172d9e19b9: Pull complete
f5eee2cb2150: Pull complete
93e404ba8667: Pull complete
Digest: sha256:859ab6768a6f26a79bc42b231664111317d095a4f04e4b6fe79ce37b3d199097
Status: Downloaded newer image <span class="token keyword">for</span> nginx:latest
docker.io/library/nginx:latest

<span class="token comment"># 方式二：查看已存在的镜像分层</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker image inspect nginx:1.21.6 | grep -i layers -A 20</span>
            <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;layers&quot;</span>,
            <span class="token string">&quot;Layers&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;sha256:9c1b6dd6c1e6be9fdd2b1987783824670d3b0dd7ae8ad6f57dc3cea5739ac71e&quot;</span>,
                <span class="token string">&quot;sha256:4b7fffa0f0a4a72b2f901c584c1d4ffb67cce7f033cc7969ee7713995c4d2610&quot;</span>,
                <span class="token string">&quot;sha256:f5ab86d69014270bcf4d5ce819b9f5c882b35527924ffdd11fecf0fc0dde81a4&quot;</span>,
                <span class="token string">&quot;sha256:c876aa251c80272eb01eec011d50650e1b8af494149696b80a606bbeccf03d68&quot;</span>,
                <span class="token string">&quot;sha256:7046505147d7f3edbf7c50c02e697d5450a2eebe5119b62b7362b10662899d85&quot;</span>,
                <span class="token string">&quot;sha256:b6812e8d56d65d296e21a639b786e7e793e8b969bd2b109fd172646ce5ebe951&quot;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;Metadata&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;LastTagTime&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0001-01-01T00:00:00Z&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span> 
</code></pre></div><p>还可以通过第三方工具<code>dive</code>来查看更具体一些的信息，Github：<a href="https://github.com/wagoodman/dive" target="_blank" rel="noopener noreferrer">https://github.com/wagoodman/dive<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://tuchuang-1257805459.cos.ap-shanghai.myqcloud.com/image-20220510152343911.png" alt="image-20220510152343911"></p><h4 id="镜像导出和导入" tabindex="-1"><a class="header-anchor" href="#镜像导出和导入" aria-hidden="true">#</a> 镜像导出和导入</h4><p>主要有两组命令：</p><ul><li>镜像导出和导入<code>save</code>和<code>load</code><ul><li><code>docker save</code>：导出一个或多个镜像，参数可以跟镜像名，也可以跟容器名（会自动分析所使用的镜像并导出）</li><li><code>docker load</code>：导入镜像</li></ul></li><li>容器文件系统导出和导入<code>export</code>和<code>import</code><ul><li><code>docker export</code>：导出一个容器的文件系统</li><li><code>docker import</code>：导入文件系统镜像</li></ul></li></ul><p><strong>镜像导出和导</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 查看本地镜像</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker image ls</span>
REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
nginx         <span class="token number">1.21</span>.6    fa5269854a5e   <span class="token number">2</span> weeks ago    142MB

<span class="token comment"># 导出镜像</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker image save nginx:1.21.6 -o nginx-1.21.6.tar</span>

<span class="token comment"># 删除镜像</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker image rm nginx:1.21.6</span>
Untagged: nginx:1.21.6

<span class="token comment"># 导入镜像</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker image load -i nginx-1.21.6.tar</span>
Loaded image: nginx:1.21.6
</code></pre></div><p><strong>容器文件系统导出和导入</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 启动一个容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -itd --name webserver nginx:1.21.6 </span>
3bcb02c10189d426e7892afd9fb086148956d720062cf0f42bb45b887aeb8624

<span class="token comment"># 写入点数据</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it webserver sh</span>
<span class="token comment"># seq 10 &gt; 1.txt</span>
<span class="token comment"># cat 1.txt</span>
<span class="token number">1</span>
<span class="token punctuation">..</span>.
<span class="token number">10</span>

<span class="token comment"># 查看容器，输出结果保存下来后面要用到</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver &gt; webserver.inspect.txt</span>

<span class="token comment"># 导出容器文件系统</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container export webserver -o webserver.tar</span>

<span class="token comment"># 导入文件系统为镜像，nginx:webserver为导入后新镜像的REPOSITORY和TAG，可以不指定但最好指定一下，否则会显示none</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker image import webserver.tar nginx:webserver</span>
sha256:2ee413eebb660f37d31a6ebc696832c09b044499892f68101478182d73e9a24b

<span class="token comment"># 查看镜像</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker image ls</span>
REPOSITORY   TAG         IMAGE ID       CREATED          SIZE
nginx        webserver   2ee413eebb66   <span class="token number">12</span> seconds ago   140MB
nginx        <span class="token number">1.21</span>.6      fa5269854a5e   <span class="token number">2</span> weeks ago      142MB

<span class="token comment"># 直接使用新镜像启动容器会报错，因为导入的容器需要重新指定工作目录和开放的端口以及启动命令</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -itd --name webserver1 nginx:webserver</span>
docker: Error response from daemon: No <span class="token builtin class-name">command</span> specified.
See <span class="token string">&#39;docker run --help&#39;</span><span class="token builtin class-name">.</span>

<span class="token comment"># 重新启动镜像</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -itd --name webserver2 -w &quot;&quot; --expose 80 --entrypoint &quot;/docker-entrypoint.sh&quot; nginx:webserver nginx -g &#39;daemon off;&#39;</span>
073eb2ac6f29f55c956329bdb12f5d4078c026217e5285a8c6a94ac76e9c4eb0

<span class="token comment"># 查看数据是否还存在</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it webserver2 sh</span>
<span class="token comment"># cat 1.txt</span>
<span class="token number">1</span>
<span class="token punctuation">..</span>.
<span class="token number">10</span>
</code></pre></div><h4 id="dockerfile-1-简介和常用指令" tabindex="-1"><a class="header-anchor" href="#dockerfile-1-简介和常用指令" aria-hidden="true">#</a> Dockerfile(1):简介和常用指令</h4><p>Dockerrfile是一个文本文件，记录了构建镜像的所有步骤</p><p>文档：<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/engine/reference/builder/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>缓存特性</strong></p><p>Dockerrfile中每一个指令都会创建一个镜像层，上层依赖于下层，docker会缓存已有的镜像层，当某一层发生变化，其上面的所有层都会失效，也就是说当我们改变Dockerfile中指令的执行顺序，或者修改指令，都会使上面的镜像层缓存失效</p><p><strong>Dockerfile常用指令</strong></p><table><thead><tr><th>指令</th><th>说明</th></tr></thead><tbody><tr><td>FROM</td><td>指定基础镜像</td></tr><tr><td>MATAINER</td><td>设置镜像作者，可以是任意字符串</td></tr><tr><td>ENV</td><td>设置环境变量</td></tr><tr><td>WORKDIR</td><td>为后面的COPY、ADD、RUN、CMD、ENTRYPOINT等设置工作目录</td></tr><tr><td>COPY</td><td>将文件复制到镜像</td></tr><tr><td>ADD</td><td>将文件复制到镜像，如果文件是归档文件（tar/zip/tgz等）会自动解压</td></tr><tr><td>EXPOSE</td><td>显式地指定容器中的进程会监听某个端口<br>（1）并不会直接将端口自动和宿主机某个端口建立映射关系<br>（2）如果docker run指定-P参数（自动映射）会将所有暴露的端口随机映射到宿主机的高阶端口<br>（3）如果docker run 指定了--net=host（宿主机模式），容器中 EXPOSE 指令暴露的端口会直接使用宿主机对应的端口</td></tr><tr><td>VOLUME</td><td>将文件或目录声明为volume</td></tr><tr><td>RUN</td><td>在容器中运行指定的命令，通常用于安装应用和软件包</td></tr><tr><td>ENTRYPOINT</td><td>设置容器启动时运行的命令<br>（2）CMD或之后的参数会被当做参数传递给ENTRYPOINT</td></tr><tr><td>CMD</td><td>设置容器启动时运行的命令<br>（2）CMD命令可以被docker run之后的参数替换</td></tr></tbody></table><h4 id="dockerfile-2-cmd和entrypoint" tabindex="-1"><a class="header-anchor" href="#dockerfile-2-cmd和entrypoint" aria-hidden="true">#</a> Dockerfile(2):CMD和ENTRYPOINT</h4><p><strong>相同点</strong></p><ul><li><p>可以有多个CMD或ENTRYPOINT命令但只有最后一个生效</p></li><li><p>都支持Exec和Shell语法格式</p><details class="custom-container details"><summary>以CMD指令举例Exec和Shell格式</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># Exec格式</span>
CMD <span class="token punctuation">[</span>可执行程序, 参数1, 参数2, 参数N<span class="token punctuation">..</span>.<span class="token punctuation">]</span>

<span class="token comment"># Shell格式</span>
CMD 可执行程序 参数1 参数2 参数N<span class="token punctuation">..</span>.
</code></pre></div></details></li><li><p><code>docker container run</code>时可以覆盖镜像中的<code>CMD</code>或<code>ENTRYPOINT</code>命令</p></li></ul><p><strong>不同点</strong></p><ul><li><p><code>docker container run</code>时覆盖镜像中的<code>CMD</code>或<code>ENTRYPOINT</code>命令时的语法不一样</p></li><li><p>CMD额外支持一种格式，<code>CMD [参数1, 参数2]</code>，此时可以为ENTRYPOINT指定提供参数（注意：ENTRYPOINT必须使用Exec格式）</p><p>一般我们用作容器启动的默认参数，当用户想替换默认参数时就等同于替换CMD中的参数</p></li></ul><p><strong>测试</strong></p><details class="custom-container details"><summary>相同点测试1：可以有多个CMD或ENTRYPOINT命令但只有最后一个生效</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 先看一下Dockerfile</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile </span>
FROM centos:7
MAINTAINER VVFock3r
WORKDIR /
RUN yum -y update
CMD <span class="token builtin class-name">echo</span> <span class="token string">&quot;Hello World!&quot;</span>
CMD <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">seq</span> <span class="token number">5</span><span class="token variable">`</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$i</span><span class="token punctuation">;</span> <span class="token function">sleep</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">done</span>

<span class="token comment"># 构建镜像（命令输出省略）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker build -t centos:demo .</span>

<span class="token comment"># 启动容器</span>
<span class="token comment"># 可以看到Hello World!并没有输出出来</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --rm centos:demo</span>
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">4</span>
<span class="token number">5</span>

<span class="token comment"># 将Dockerfile中的CMD替换为ENTRYPOINT测试一下，发现效果是一样的</span>
</code></pre></div></details><details class="custom-container details"><summary>相同点测试2：都支持Exec和Shell格式语法</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile </span>
FROM centos:7
MAINTAINER VVFock3r
WORKDIR /
RUN yum -y update
<span class="token comment"># Exec语法</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span>, <span class="token string">&quot;-l&quot;</span><span class="token punctuation">]</span>
<span class="token comment"># Shell语法</span>
<span class="token comment"># CMD ls -l</span>

<span class="token comment"># 构建镜像（命令输出省略）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker build -t centos:demo .</span>

<span class="token comment"># 启动容器（命令输出省略）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --rm centos:demo</span>

<span class="token comment"># 使用CMD不同格式、ENTRYPOINT不同格式重复测试，发现效果是一样的</span>
</code></pre></div></details><details class="custom-container details"><summary>不同点测试1：`docker container run`时覆盖镜像中的`CMD`或`ENTRYPOINT`命令时的语法不一样</summary><p>先看一下<code>docker container run</code>的语法格式</p><p><img src="https://tuchuang-1257805459.cos.ap-shanghai.myqcloud.com/image-20220511175138893.png" alt="image-20220511175138893"></p><p><img src="https://tuchuang-1257805459.cos.ap-shanghai.myqcloud.com/image-20220511175249716.png" alt="image-20220511175249716"></p><p>开始我们的测试</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 覆盖镜像中CMD指令的语法</span>
<span class="token comment"># ---------------------------------------------------------------------------------------------</span>
<span class="token comment"># 先看一下Dockerfile</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile </span>
FROM centos:7
MAINTAINER VVFock3r
WORKDIR /
RUN yum -y update
CMD <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">seq</span> <span class="token number">5</span><span class="token variable">`</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$i</span><span class="token punctuation">;</span> <span class="token function">sleep</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">done</span>

<span class="token comment"># 构建镜像（命令输出省略）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker build -t centos:demo .</span>

<span class="token comment"># 启动容器（命令输出省略）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --rm centos:demo	    # 使用默认参数启动容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --rm centos:demo ls -l # 使用自定义的命令和参数启动容器</span>
<span class="token comment"># ---------------------------------------------------------------------------------------------</span>

<span class="token comment"># 覆盖镜像中ENTRYPOINT指令的语法</span>
<span class="token comment"># 将上面Dockerfile中CMD替换为ENTRYPOINT，重新构建镜像，然后继续下一步</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --rm centos:demo						# 使用默认参数启动容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --rm --entrypoint ls centos:demo		# 替换默认的ENTRYPOINT</span>

<span class="token comment"># 如果我们想给ENTRYPOINT加一个参数，可能会这样写，但是报错了</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --rm --entrypoint ls -l centos:demo	</span>
<span class="token string">&quot;docker container run&quot;</span> requires at least <span class="token number">1</span> argument.
See <span class="token string">&#39;docker container run --help&#39;</span><span class="token builtin class-name">.</span>

Usage:  <span class="token function">docker</span> container run <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> IMAGE <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARG<span class="token punctuation">..</span>.<span class="token punctuation">]</span>

Run a <span class="token builtin class-name">command</span> <span class="token keyword">in</span> a new container
<span class="token comment"># 解决办法是参数通过CMD形式传递</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --rm --entrypoint ls  centos:demo -l -h -a --color=auto</span>
total 12K
drwxr-xr-x.   <span class="token number">1</span> root root   <span class="token number">6</span> May <span class="token number">11</span> <span class="token number">10</span>:02 <span class="token builtin class-name">.</span>
drwxr-xr-x.   <span class="token number">1</span> root root   <span class="token number">6</span> May <span class="token number">11</span> <span class="token number">10</span>:02 <span class="token punctuation">..</span>
-rwxr-xr-x.   <span class="token number">1</span> root root   <span class="token number">0</span> May <span class="token number">11</span> <span class="token number">10</span>:02 .dockerenv
-rw-r--r--.   <span class="token number">1</span> root root 12K Nov <span class="token number">13</span>  <span class="token number">2020</span> anaconda-post.log
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">7</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> bin -<span class="token operator">&gt;</span> usr/bin
drwxr-xr-x.   <span class="token number">5</span> root root <span class="token number">340</span> May <span class="token number">11</span> <span class="token number">10</span>:02 dev
drwxr-xr-x.   <span class="token number">1</span> root root  <span class="token number">66</span> May <span class="token number">11</span> <span class="token number">10</span>:02 etc
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> home
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">7</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> lib -<span class="token operator">&gt;</span> usr/lib
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">9</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> lib64 -<span class="token operator">&gt;</span> usr/lib64
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> media
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> mnt
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> opt
dr-xr-xr-x. <span class="token number">221</span> root root   <span class="token number">0</span> May <span class="token number">11</span> <span class="token number">10</span>:02 proc
dr-xr-x---.   <span class="token number">2</span> root root <span class="token number">114</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> root
drwxr-xr-x.   <span class="token number">1</span> root root  <span class="token number">19</span> May <span class="token number">11</span> 09:22 run
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">8</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> sbin -<span class="token operator">&gt;</span> usr/sbin
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> srv
dr-xr-xr-x.  <span class="token number">13</span> root root   <span class="token number">0</span> May <span class="token number">11</span> 05:51 sys
drwxrwxrwt.   <span class="token number">1</span> root root   <span class="token number">6</span> May <span class="token number">11</span> 09:22 tmp
drwxr-xr-x.   <span class="token number">1</span> root root  <span class="token number">96</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> usr
drwxr-xr-x.   <span class="token number">1</span> root root  <span class="token number">78</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> var
</code></pre></div></details><details class="custom-container details"><summary>不同点测试2：CMD可以为ENTRYPOINT指定提供默认参数（ENTRYPOINT必须使用Exec格式）</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 查看Dockerfile</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile </span>
FROM centos:7
MAINTAINER VVFock3r
WORKDIR /
RUN yum -y update
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">&quot;ls&quot;</span><span class="token punctuation">]</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;-l&quot;</span>, <span class="token string">&quot;-h&quot;</span><span class="token punctuation">]</span>

<span class="token comment"># 构建镜像（命令输出省略）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker build -t centos:demo .</span>

<span class="token comment"># 启动容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -it --rm centos:demo</span>
total 12K
-rw-r--r--.   <span class="token number">1</span> root root 12K Nov <span class="token number">13</span>  <span class="token number">2020</span> anaconda-post.log
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">7</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> bin -<span class="token operator">&gt;</span> usr/bin
drwxr-xr-x.   <span class="token number">5</span> root root <span class="token number">360</span> May <span class="token number">11</span> <span class="token number">10</span>:09 dev
drwxr-xr-x.   <span class="token number">1</span> root root  <span class="token number">66</span> May <span class="token number">11</span> <span class="token number">10</span>:09 etc
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> home
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">7</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> lib -<span class="token operator">&gt;</span> usr/lib
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">9</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> lib64 -<span class="token operator">&gt;</span> usr/lib64
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> media
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> mnt
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> opt
dr-xr-xr-x. <span class="token number">219</span> root root   <span class="token number">0</span> May <span class="token number">11</span> <span class="token number">10</span>:09 proc
dr-xr-x---.   <span class="token number">2</span> root root <span class="token number">114</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> root
drwxr-xr-x.   <span class="token number">1</span> root root  <span class="token number">19</span> May <span class="token number">11</span> 09:22 run
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">8</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> sbin -<span class="token operator">&gt;</span> usr/sbin
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> srv
dr-xr-xr-x.  <span class="token number">13</span> root root   <span class="token number">0</span> May <span class="token number">11</span> 05:51 sys
drwxrwxrwt.   <span class="token number">1</span> root root   <span class="token number">6</span> May <span class="token number">11</span> 09:22 tmp
drwxr-xr-x.   <span class="token number">1</span> root root  <span class="token number">96</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> usr
drwxr-xr-x.   <span class="token number">1</span> root root  <span class="token number">78</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> var

<span class="token comment"># ---------------------------------------------------------------------------------------------</span>
<span class="token comment"># 现在我们将 ENTRYPOINT [&quot;ls&quot;]替换为 ENTRYPOINT ls，来验证Shell格式是否可以</span>

<span class="token comment"># 修改Dockerfile（省略）</span>
<span class="token comment"># 构建镜像（命令输出省略）</span>

<span class="token comment"># 启动容器，可以看到CMD中的参数并没有生效</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -it --rm centos:demo</span>
anaconda-post.log  dev  home  lib64  mnt  proc  run   srv  tmp  var
bin                etc  lib   media  opt  root  sbin  sys  usr

<span class="token comment"># 我们使用命令行覆盖CMD指令呢，也没有生效</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -it --rm centos:demo -l -h </span>
anaconda-post.log  dev  home  lib64  mnt  proc  run   srv  tmp  var
bin                etc  lib   media  opt  root  sbin  sys  usr

<span class="token comment"># 我们再覆盖一下ENTRYPOINT呢，可以看到生效了（意料之中）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --entrypoint ls -it --rm centos:demo -l -h </span>
total 12K
-rw-r--r--.   <span class="token number">1</span> root root 12K Nov <span class="token number">13</span>  <span class="token number">2020</span> anaconda-post.log
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">7</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> bin -<span class="token operator">&gt;</span> usr/bin
drwxr-xr-x.   <span class="token number">5</span> root root <span class="token number">360</span> May <span class="token number">11</span> <span class="token number">10</span>:12 dev
drwxr-xr-x.   <span class="token number">1</span> root root  <span class="token number">66</span> May <span class="token number">11</span> <span class="token number">10</span>:12 etc
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> home
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">7</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> lib -<span class="token operator">&gt;</span> usr/lib
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">9</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> lib64 -<span class="token operator">&gt;</span> usr/lib64
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> media
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> mnt
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> opt
dr-xr-xr-x. <span class="token number">219</span> root root   <span class="token number">0</span> May <span class="token number">11</span> <span class="token number">10</span>:12 proc
dr-xr-x---.   <span class="token number">2</span> root root <span class="token number">114</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> root
drwxr-xr-x.   <span class="token number">1</span> root root  <span class="token number">19</span> May <span class="token number">11</span> 09:22 run
lrwxrwxrwx.   <span class="token number">1</span> root root   <span class="token number">8</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> sbin -<span class="token operator">&gt;</span> usr/sbin
drwxr-xr-x.   <span class="token number">2</span> root root   <span class="token number">6</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> srv
dr-xr-xr-x.  <span class="token number">13</span> root root   <span class="token number">0</span> May <span class="token number">11</span> 05:51 sys
drwxrwxrwt.   <span class="token number">1</span> root root   <span class="token number">6</span> May <span class="token number">11</span> 09:22 tmp
drwxr-xr-x.   <span class="token number">1</span> root root  <span class="token number">96</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> usr
drwxr-xr-x.   <span class="token number">1</span> root root  <span class="token number">78</span> Nov <span class="token number">13</span>  <span class="token number">2020</span> var
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre></div></details><h4 id="dockerfile-3-多阶段构建优化go项目" tabindex="-1"><a class="header-anchor" href="#dockerfile-3-多阶段构建优化go项目" aria-hidden="true">#</a> Dockerfile(3):多阶段构建优化Go项目</h4><p>（1）创建Go项目</p><details class="custom-container details"><summary>点击查看详情</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mkdir webserver</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cd webserver</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># go mod init webserver</span>
go: creating new go.mod: module webserver

<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># cat server.go</span>
package main

<span class="token function">import</span> <span class="token punctuation">(</span>
        <span class="token string">&quot;fmt&quot;</span>
        <span class="token string">&quot;io&quot;</span>
        <span class="token string">&quot;log&quot;</span>
        <span class="token string">&quot;net/http&quot;</span>
<span class="token punctuation">)</span>

// 处理器
func indexHandler<span class="token punctuation">(</span>w http.ResponseWriter, req *http.Request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        io.WriteString<span class="token punctuation">(</span>w, <span class="token string">&quot;Hello, world!<span class="token entity" title="\n">\n</span>&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

func <span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        // 监听地址
        addr :<span class="token operator">=</span> <span class="token string">&quot;0.0.0.0:80&quot;</span>

        // 注册路由
        http.HandleFunc<span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span>, indexHandler<span class="token punctuation">)</span>

        // 启动服务
        fmt.Println<span class="token punctuation">(</span><span class="token string">&quot;* Running on http://&quot;</span> + addr<span class="token punctuation">)</span>
        log.Fatal<span class="token punctuation">(</span>http.ListenAndServe<span class="token punctuation">(</span>addr, nil<span class="token punctuation">))</span>
<span class="token punctuation">}</span>
</code></pre></div></details><p>（2）编写Dockerfile</p><details class="custom-container details"><summary>点击查看详情</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile</span>
FROM golang:1.18
MAINTAINER VVFock3r
WORKDIR /
COPY server.go <span class="token builtin class-name">.</span>
RUN go build -o server server.go
EXPOSE <span class="token number">80</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;./server&quot;</span><span class="token punctuation">]</span>
</code></pre></div></details><p>（3）构建镜像</p><details class="custom-container details"><summary>点击查看详情</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># docker build -t server:v1 .</span>
Sending build context to Docker daemon  <span class="token number">4</span>.096kB
Step <span class="token number">1</span>/6 <span class="token builtin class-name">:</span> FROM golang:1.18
<span class="token number">1.18</span>: Pulling from library/golang
6aefca2dc61d: Pull complete 
967757d56527: Pull complete 
c357e2c68cb3: Pull complete 
c766e27afb21: Pull complete 
d6a8ea6bd5f8: Pull complete 
886d528c0894: Pull complete 
ad84389257db: Pull complete 
Digest: sha256:aa0c16158472cfa9122ea7c54f3933ad79d1e860f216540750ed440bcce841c7
Status: Downloaded newer image <span class="token keyword">for</span> golang:1.18
 ---<span class="token operator">&gt;</span> 65b2f1fa535f
Step <span class="token number">2</span>/6 <span class="token builtin class-name">:</span> MAINTAINER VVFock3r
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> fb57751c56ef
Removing intermediate container fb57751c56ef
 ---<span class="token operator">&gt;</span> 4c0e15145939
Step <span class="token number">3</span>/6 <span class="token builtin class-name">:</span> WORKDIR /
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 3ecd4a2870f5
Removing intermediate container 3ecd4a2870f5
 ---<span class="token operator">&gt;</span> 9dcc78ced4ad
Step <span class="token number">4</span>/6 <span class="token builtin class-name">:</span> COPY server.go <span class="token builtin class-name">.</span>
 ---<span class="token operator">&gt;</span> 34f5e234c295
Step <span class="token number">5</span>/6 <span class="token builtin class-name">:</span> RUN go build -o server server.go
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 8db00c31bc37
Removing intermediate container 8db00c31bc37
 ---<span class="token operator">&gt;</span> 58736ed6175c
Step <span class="token number">6</span>/6 <span class="token builtin class-name">:</span> CMD <span class="token punctuation">[</span><span class="token string">&quot;./server&quot;</span><span class="token punctuation">]</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> e58aa4c9f890
Removing intermediate container e58aa4c9f890
 ---<span class="token operator">&gt;</span> 5117b956c216
Successfully built 5117b956c216
Successfully tagged server:v1

<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># docker image ls </span>
REPOSITORY   TAG          IMAGE ID       CREATED              SIZE
server       v1           f4c28a054488   About a minute ago   970MB		<span class="token comment"># 比原始镜像多了几M</span>
golang       <span class="token number">1.18</span>         65b2f1fa535f   <span class="token number">9</span> hours ago          964MB
</code></pre></div></details><p>（4）启动容器试一下</p><details class="custom-container details"><summary>点击查看详情</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 启动容器</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># docker container run -itd -P --name server1 server:v1</span>
b4b2c3f81fa96738b7300ee17a83c7c4803702c0038fd9020380e3bb5b05b759

<span class="token comment"># 查看宿主机映射的端口</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE       COMMAND      CREATED          STATUS          PORTS                                     NAMES
b4b2c3f81fa9   server:v1   <span class="token string">&quot;./server&quot;</span>   <span class="token number">12</span> seconds ago   Up <span class="token number">10</span> seconds   <span class="token number">0.0</span>.0.0:49160-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::49160-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   server1

<span class="token comment"># 访问宿主机端口</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># curl http://127.0.0.1:49160</span>
Hello, world<span class="token operator">!</span>
</code></pre></div></details><p>（5）镜像大小第一次优化：先编译Go项目，然后将编译好的二进制拷贝到镜像中</p><details class="custom-container details"><summary>点击查看详情</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 关闭CGO_ENABLED</span>
<span class="token comment"># 原理：</span>
<span class="token comment">#   (1) Go在编译时可以选择使用C链接库(C链接库不打包进程序)或纯Go编译(打包所有内容)，CGO_ENABLED参数控制是否启用CGO</span>
<span class="token comment">#   (2) alpine镜像不包含C链接库，所以当我们启用CGO时同时又使用alpine镜像时，程序会报错not found</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># go env CGO_ENABLED				# 先查看一下CGO_ENABLED这个变量</span>
<span class="token number">1</span>															<span class="token comment"># 1代表开启</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># go env -w CGO_ENABLED=0			# 关闭</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># go build -o server server.go 	# 打包</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># ls -lh server					# 看一下大小</span>
-rwxr-xr-x. <span class="token number">1</span> root root <span class="token number">6</span>.0M May <span class="token number">11</span> <span class="token number">15</span>:08 server			<span class="token comment"># 6M</span>

<span class="token comment"># 修改Dockerfile</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile</span>
FROM alpine:3.15.4
MAINTAINER VVFock3r
WORKDIR /
COPY server <span class="token builtin class-name">.</span>
EXPOSE <span class="token number">80</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;./server&quot;</span><span class="token punctuation">]</span>

<span class="token comment"># 重新构建镜像</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># docker build -t server:v2 .</span>
Sending build context to Docker daemon  <span class="token number">6</span>.241MB
Step <span class="token number">1</span>/6 <span class="token builtin class-name">:</span> FROM alpine:3.15.4
<span class="token number">3.15</span>.4: Pulling from library/alpine
df9b9388f04a: Pull complete 
Digest: sha256:4edbd2beb5f78b1014028f4fbb99f3237d9561100b6881aabbf5acce2c4f9454
Status: Downloaded newer image <span class="token keyword">for</span> alpine:3.15.4
 ---<span class="token operator">&gt;</span> 0ac33e5f5afa
Step <span class="token number">2</span>/6 <span class="token builtin class-name">:</span> MAINTAINER VVFock3r
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> d7a9ef482595
Removing intermediate container d7a9ef482595
 ---<span class="token operator">&gt;</span> aa47686fe08c
Step <span class="token number">3</span>/6 <span class="token builtin class-name">:</span> WORKDIR /
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> b3399ac114c8
Removing intermediate container b3399ac114c8
 ---<span class="token operator">&gt;</span> 0b16c287b5e2
Step <span class="token number">4</span>/6 <span class="token builtin class-name">:</span> COPY server <span class="token builtin class-name">.</span>
 ---<span class="token operator">&gt;</span> 453e503273fd
Step <span class="token number">5</span>/6 <span class="token builtin class-name">:</span> EXPOSE <span class="token number">80</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> af5e153a1d41
Removing intermediate container af5e153a1d41
 ---<span class="token operator">&gt;</span> 6b7a8f1c22aa
Step <span class="token number">6</span>/6 <span class="token builtin class-name">:</span> CMD <span class="token punctuation">[</span><span class="token string">&quot;./server&quot;</span><span class="token punctuation">]</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> a37a4e6c84de
Removing intermediate container a37a4e6c84de
 ---<span class="token operator">&gt;</span> 523d460fc716
Successfully built 523d460fc716
Successfully tagged server:v2

<span class="token comment"># 查看镜像大小</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># docker image ls</span>
REPOSITORY   TAG       IMAGE ID       CREATED          SIZE
server       v2        523d460fc716   <span class="token number">21</span> seconds ago   <span class="token number">11</span>.8MB	<span class="token comment"># 不到12M,小了太多了(偷笑zzz)</span>
server       v1        86114e9e8c94   <span class="token number">3</span> minutes ago    970MB
golang       <span class="token number">1.18</span>      65b2f1fa535f   <span class="token number">9</span> hours ago      964MB
alpine       <span class="token number">3.15</span>.4    0ac33e5f5afa   <span class="token number">5</span> weeks ago      <span class="token number">5</span>.57MB

<span class="token comment"># 启动容器测一下</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># docker run -itd -P --name server2 server:v2</span>

<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE       COMMAND      CREATED         STATUS         PORTS                                     NAMES
89c5596ec80c   server:v2   <span class="token string">&quot;./server&quot;</span>   <span class="token number">3</span> seconds ago   Up <span class="token number">3</span> seconds   <span class="token number">0.0</span>.0.0:49161-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::49161-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   server2
b4b2c3f81fa9   server:v1   <span class="token string">&quot;./server&quot;</span>   <span class="token number">3</span> minutes ago   Up <span class="token number">3</span> minutes   <span class="token number">0.0</span>.0.0:49160-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::49160-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   server1

<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># curl http://127.0.0.1:49161</span>
Hello, world<span class="token operator">!</span>

<span class="token comment"># 删除宿主机编译出来的二进制文件</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># rm -vf server</span>
removed <span class="token string">&#39;server&#39;</span>
</code></pre></div></details><p>（6）镜像大小第二次优化：使用镜像多阶段构建（推荐）</p><details class="custom-container details"><summary>点击查看详情</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 修改Dockerfile</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile</span>
<span class="token comment"># 用于程序编译</span>
FROM golang:1.18.2-alpine3.15 as builder
WORKDIR /build
COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>
RUN go build -o server server.go

<span class="token comment"># 用于程序运行</span>
FROM alpine:3.15.4
MAINTAINER VVFock3r
WORKDIR /
COPY --from<span class="token operator">=</span>builder /build/server <span class="token builtin class-name">.</span>
EXPOSE <span class="token number">80</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;./server&quot;</span><span class="token punctuation">]</span>

<span class="token comment"># 构建镜像</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># docker build -t server:v3 .</span>
Sending build context to Docker daemon  <span class="token number">4</span>.096kB
Step <span class="token number">1</span>/10 <span class="token builtin class-name">:</span> FROM golang:1.18.2-alpine3.15 as builder
 ---<span class="token operator">&gt;</span> 04a96eefde03
Step <span class="token number">2</span>/10 <span class="token builtin class-name">:</span> WORKDIR /build
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> f8278f940644
Step <span class="token number">3</span>/10 <span class="token builtin class-name">:</span> COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>
 ---<span class="token operator">&gt;</span> 64b46b7ef7c6
Step <span class="token number">4</span>/10 <span class="token builtin class-name">:</span> RUN go build -o server server.go
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 6566bc10f3ad
Removing intermediate container 6566bc10f3ad
 ---<span class="token operator">&gt;</span> 4b196dce6953
Step <span class="token number">5</span>/10 <span class="token builtin class-name">:</span> FROM alpine:3.15.4
 ---<span class="token operator">&gt;</span> 0ac33e5f5afa
Step <span class="token number">6</span>/10 <span class="token builtin class-name">:</span> MAINTAINER VVFock3r
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> aa47686fe08c
Step <span class="token number">7</span>/10 <span class="token builtin class-name">:</span> WORKDIR /
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> 0b16c287b5e2
Step <span class="token number">8</span>/10 <span class="token builtin class-name">:</span> COPY --from<span class="token operator">=</span>builder /build/server <span class="token builtin class-name">.</span>
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> aef7aafb227f
Step <span class="token number">9</span>/10 <span class="token builtin class-name">:</span> EXPOSE <span class="token number">80</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 4f4e2181aae4
Removing intermediate container 4f4e2181aae4
 ---<span class="token operator">&gt;</span> 47d2bc51d9b0
Step <span class="token number">10</span>/10 <span class="token builtin class-name">:</span> CMD <span class="token punctuation">[</span><span class="token string">&quot;./server&quot;</span><span class="token punctuation">]</span>
 ---<span class="token operator">&gt;</span> Running <span class="token keyword">in</span> 7dbea4b80753
Removing intermediate container 7dbea4b80753
 ---<span class="token operator">&gt;</span> 24f2f7c399db
Successfully built 24f2f7c399db
Successfully tagged server:v3

<span class="token comment"># 查看镜像大小</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># docker image ls</span>
REPOSITORY   TAG                 IMAGE ID       CREATED              SIZE
server       v3                  24f2f7c399db   <span class="token number">18</span> seconds ago       <span class="token number">11</span>.9MB		<span class="token comment"># 和v2大小几乎一致</span>
server       v2                  523d460fc716   <span class="token number">12</span> minutes ago       <span class="token number">11</span>.8MB
server       v1                  86114e9e8c94   <span class="token number">15</span> minutes ago       970MB
golang       <span class="token number">1.18</span>.2-alpine3.15   04a96eefde03   <span class="token number">10</span> hours ago         328MB
golang       <span class="token number">1.18</span>                65b2f1fa535f   <span class="token number">10</span> hours ago         964MB
alpine       <span class="token number">3.15</span>.4              0ac33e5f5afa   <span class="token number">5</span> weeks ago          <span class="token number">5</span>.57MB

<span class="token comment"># 启动容器测一下</span>
<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># docker run -itd -P --name server3 server:v3</span>

<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE       COMMAND      CREATED          STATUS          PORTS                                     NAMES
10f33df3efc1   server:v3   <span class="token string">&quot;./server&quot;</span>   <span class="token number">5</span> seconds ago    Up <span class="token number">4</span> seconds    <span class="token number">0.0</span>.0.0:49162-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::49162-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   server3
89c5596ec80c   server:v2   <span class="token string">&quot;./server&quot;</span>   <span class="token number">13</span> minutes ago   Up <span class="token number">13</span> minutes   <span class="token number">0.0</span>.0.0:49161-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::49161-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   server2
b4b2c3f81fa9   server:v1   <span class="token string">&quot;./server&quot;</span>   <span class="token number">16</span> minutes ago   Up <span class="token number">16</span> minutes   <span class="token number">0.0</span>.0.0:49160-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::49160-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   server1

<span class="token punctuation">[</span>root@localhost webserver<span class="token punctuation">]</span><span class="token comment"># curl http://127.0.0.1:49162</span>
Hello, world<span class="token operator">!</span>
</code></pre></div></details><h3 id="docker存储" tabindex="-1"><a class="header-anchor" href="#docker存储" aria-hidden="true">#</a> Docker存储</h3><h4 id="持久化方式1-bind-mounts" tabindex="-1"><a class="header-anchor" href="#持久化方式1-bind-mounts" aria-hidden="true">#</a> 持久化方式1：<code>bind mounts</code></h4><p>文档：<a href="https://docs.docker.com/storage/bind-mounts/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/storage/bind-mounts/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><code>bind mounts</code>方式就是将宿主机上的目录映射到容器中，其特点是以宿主机目录为准，</p><p>若宿主机目录为空而容器目录不为空，那么容器目录将被清空（与宿主机保持一致）</p><p><code>bind mounts</code>有两种使用方式：</p><br><p>（1）<code>-v</code>选项</p><p>语法：<code>docker container run</code>时使用 <code>-v &quot;宿主机目录:容器目录[:读写模式]&quot;</code></p><p>选项：</p><ul><li>rw：读写模式（默认）</li><li>ro：容器只读模式</li></ul><br><p>（2）<code>--mount</code>选项</p><p>语法：<code>docker container run</code>时使用 <code>--mount type=bind,src=宿主机目录,dst=容器目录[,读写模式][,bind-propagation=rprivate] </code></p><p>选项：</p><ul><li><code>type=bind</code>是固定的，还支持其他的值，但就不属于<code>bind mounts</code>的内容了</li><li><code>src</code>也可以写做<code>source</code></li><li><code>dst</code>也可以写作<code>target</code>、<code>destination</code></li><li>读写模式：默认为读写，如果值为readonly则容器内只读</li><li><code>bind-propagation</code>一般用不到，先不讲</li></ul><br><p>（3）<code>-v</code>和<code>--mount</code>的不同点</p><p>在映射时如果本地目录不存在，<code>-v</code>选项会自动创建本地目录，<code>--mount</code>选项则会报错</p><br><p>示例</p><details class="custom-container details"><summary>(1) 基础示例 -v选项</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 启动一个容器，将本地目录html映射到容器/usr/share/nginx/html中</span>
<span class="token comment"># (1) 如果本地目录不存在则自动创建</span>
<span class="token comment"># (2) 如果容器中的目录原本是有内容的也会被删除，要与本地目录保持一致的数据</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name webserver -p 8000:80 -d -v /root/html:/usr/share/nginx/html  nginx:1.21.6</span>

<span class="token comment"># 创建首页文件</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># echo &#39;hello world!&#39; &gt; /root/html/index.html</span>

<span class="token comment"># 查看容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS         PORTS                                   NAMES
cb1416a20f8e   nginx:1.21.6   <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   <span class="token number">7</span> seconds ago   Up <span class="token number">6</span> seconds   <span class="token number">0.0</span>.0.0:8000-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::8000-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   webserver

<span class="token comment"># 访问测试</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># curl http://127.0.0.1:8000/</span>
hello world<span class="token operator">!</span>

<span class="token comment"># 查看容器详情</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver  | grep -i -A 10 Mounts </span>
        <span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bind&quot;</span>,								<span class="token comment"># 类型</span>
                <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/html&quot;</span>,						<span class="token comment"># 宿主机目录</span>
                <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/share/nginx/html&quot;</span>,		<span class="token comment"># 容器目录</span>
                <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,									<span class="token comment"># 模式</span>
                <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,									<span class="token comment"># 是否支持读写</span>
                <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rprivate&quot;</span>					<span class="token comment"># 传播方式</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
</code></pre></div></details><details class="custom-container details"><summary>(2) 基础示例 --mount选项</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 创建容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name webserver -p 8000:80 -d --mount type=bind,src=/root/html,dst=/usr/share/nginx/html  nginx:1.21.6</span>

<span class="token comment"># 查看容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container ps</span>
CONTAINER ID   IMAGE          COMMAND                  CREATED              STATUS              PORTS                                   NAMES
0aa307c705af   nginx:1.21.6   <span class="token string">&quot;/docker-entrypoint.…&quot;</span>   About a minute ago   Up About a minute   <span class="token number">0.0</span>.0.0:8000-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp, :::8000-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   webserver

<span class="token comment"># 创建首页文件</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># echo &#39;hello world!&#39; &gt; /root/html/index.html</span>

<span class="token comment"># 访问测试</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># curl http://127.0.0.1:8000/</span>
hello world<span class="token operator">!</span>

<span class="token comment"># 查看容器详情</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver  | grep -i -A 10 Mounts</span>
            <span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bind&quot;</span>,
                    <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/html&quot;</span>,
                    <span class="token string">&quot;Target&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/share/nginx/html&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>,
            <span class="token string">&quot;MaskedPaths&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;/proc/asound&quot;</span>,
                <span class="token string">&quot;/proc/acpi&quot;</span>,
                <span class="token string">&quot;/proc/kcore&quot;</span>,
--
        <span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bind&quot;</span>,
                <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/root/html&quot;</span>,
                <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/share/nginx/html&quot;</span>,
                <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
                <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rprivate&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
</code></pre></div></details><details class="custom-container details"><summary>(3)映射多个目录 -v选项</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 目标：我们将nginx的配置文件目录和数据目录全部映射出来</span>

<span class="token comment"># ---------------------------------------------------------------------------------------------------------</span>
<span class="token comment"># 准备工作</span>
<span class="token comment"># 先启动一个nginx，将容器中的目录拷贝至本地，然后再进行映射（不然直接映射的话，本地又没有文件，会导致容器映射的目录会被清空，进而导致容器启动失败）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name webserver -d nginx:1.21.6</span>

<span class="token comment"># 拷贝文件到本地目录</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p nginx/etc/</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p nginx/usr/share/</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container cp webserver:/etc/nginx/ ./nginx/etc/</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container cp webserver:/usr/share/nginx/ ./nginx/usr/share/</span>

<span class="token comment"># 删除容器</span>
<span class="token function">docker</span> container <span class="token function">rm</span> -f webserver

<span class="token comment"># ---------------------------------------------------------------------------------------------------------</span>
<span class="token comment"># 创建新的容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name webserver -p 8000:80 -d -v /root/nginx/etc/nginx/:/etc/nginx/ -v /root/nginx/usr/share/nginx/:/usr/share/nginx/ nginx:1.21.6</span>

<span class="token comment"># 访问测试</span>
<span class="token punctuation">[</span>root@localhost conf.d<span class="token punctuation">]</span><span class="token comment"># curl http://127.0.0.1:8000/</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
html <span class="token punctuation">{</span> color-scheme: light dark<span class="token punctuation">;</span> <span class="token punctuation">}</span>
body <span class="token punctuation">{</span> width: 35em<span class="token punctuation">;</span> margin: <span class="token number">0</span> auto<span class="token punctuation">;</span>
font-family: Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>/style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>For online documentation and support please refer to
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">&quot;http://nginx.org/&quot;</span><span class="token operator">&gt;</span>nginx.org<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>br/<span class="token operator">&gt;</span>
Commercial support is available at
<span class="token operator">&lt;</span>a <span class="token assign-left variable">href</span><span class="token operator">=</span><span class="token string">&quot;http://nginx.com/&quot;</span><span class="token operator">&gt;</span>nginx.com<span class="token operator">&lt;</span>/a<span class="token operator">&gt;</span>.<span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Thank you <span class="token keyword">for</span> using nginx.<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre></div></details><details class="custom-container details"><summary>(4) 映射目录为只读模式 -v选项</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 创建容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name webserver -P -d -v /root/readonly:/tmp/readonly:ro nginx:1.21.6</span>

<span class="token comment"># 在容器内创建文件</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it webserver touch /tmp/readonly/a.txt</span>
touch: cannot <span class="token function">touch</span> <span class="token string">&#39;/tmp/readonly/a.txt&#39;</span><span class="token builtin class-name">:</span> Read-only <span class="token function">file</span> system
</code></pre></div></details><details class="custom-container details"><summary>(5) -v和--mount的不同</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># -v选项</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -P -d -v /tmp/a11:/tmp/a11 nginx:1.21.6</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ls -ld /tmp/a11/</span>
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">6</span> May <span class="token number">14</span> <span class="token number">16</span>:04 /tmp/a11/

<span class="token comment"># --mount选项</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -P -d --mount type=bind,src=/tmp/b11,dst=/tmp/c11 nginx:1.21.6</span>
docker: Error response from daemon: invalid <span class="token function">mount</span> config <span class="token keyword">for</span> <span class="token builtin class-name">type</span> <span class="token string">&quot;bind&quot;</span><span class="token builtin class-name">:</span> <span class="token builtin class-name">bind</span> <span class="token builtin class-name">source</span> path does not exist: /tmp/b11.
See <span class="token string">&#39;docker run --help&#39;</span><span class="token builtin class-name">.</span>
</code></pre></div></details><h4 id="持久化方式2-volumes" tabindex="-1"><a class="header-anchor" href="#持久化方式2-volumes" aria-hidden="true">#</a> 持久化方式2：<code>volumes</code></h4><p>文档：<a href="https://docs.docker.com/storage/volumes/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/storage/volumes/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><code>volumes</code>是更为推荐的持久化方式，与<code>bind mounts</code>相比具有更好的移植性</p><p>volume的使用方式与<code>bind mounts</code>很类似，详情可以看上方文档</p><br><p><code>volume</code>特点：</p><ul><li>如果卷不存在会自动创建</li><li>如果是空卷则容器目录会填充卷的内容（这一方面与<code>bind mounts</code>完全不一样）</li></ul><br><details class="custom-container details"><summary>（1）docker volume命令</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 查看卷</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME

<span class="token comment"># 创建卷</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume create webserver</span>
webserver
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     webserver

<span class="token comment"># 查看卷详情</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume inspect webserver</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;CreatedAt&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2022-05-19T15:48:06+08:00&quot;</span>,
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Mountpoint&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/webserver/_data&quot;</span>,
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;webserver&quot;</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div></details><details class="custom-container details"><summary>（2）容器使用volume（使用-v选项举例）</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 使用一个已经存在的卷</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name webserver -v webserver:/usr/share/nginx/ -d nginx:1.21.6</span>

<span class="token comment"># 查看容器信息</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver | grep -i Mounts -A 13</span>
        <span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,		<span class="token comment"># 类型为Volumn</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;webserver&quot;</span>,	<span class="token comment"># Volumn名称</span>
                <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/webserver/_data&quot;</span>,	<span class="token comment"># 对应的本地文件系统路径</span>
                <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/share/nginx/&quot;</span>,		<span class="token comment"># 对应的容器目录</span>
                <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
                <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;z&quot;</span>,
                <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
                <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Hostname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;90f3864f6b67&quot;</span>,

<span class="token comment"># ---------------------------------------------------------------------------------------------------------</span>
<span class="token comment"># 当卷不存在时docker会为我们自动创建            </span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run --name webserver1 -v webserver1:/usr/share/nginx/ -d nginx:1.21.6 # 卷webserver1并不存在</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect webserver1 | grep -i Mounts -A 13</span>
        <span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,		<span class="token comment"># 这里依旧是volume</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;webserver1&quot;</span>,
                <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/webserver1/_data&quot;</span>,
                <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/usr/share/nginx/&quot;</span>,
                <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
                <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;z&quot;</span>,
                <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
                <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Hostname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;862e24c37fc7&quot;</span>,
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     webserver
<span class="token builtin class-name">local</span>     webserver1		<span class="token comment"># 这里是自动创建的volume</span>

<span class="token comment"># ---------------------------------------------------------------------------------------------------------</span>
<span class="token comment"># volume数据为空，容器内有数据，则会将容器的数据拷贝至volume，这一点与bind mounts完全不一样。</span>
<span class="token punctuation">[</span>root@localhost html<span class="token punctuation">]</span><span class="token comment"># cd /var/lib/docker/volumes/webserver/_data</span>
<span class="token punctuation">[</span>root@localhost _data<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">0</span>
drwxr-xr-x. <span class="token number">2</span> root root <span class="token number">40</span> May <span class="token number">19</span> <span class="token number">16</span>:01 html
</code></pre></div></details><details class="custom-container details"><summary>（3）Dockerfile中的VOLUME指令</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># Dockerfile中的VOLUME指令与EXPOSE类似，在构建镜像时并不会自动创建VOLUME，而是作为一个显示声明</span>
<span class="token comment"># 当我们创建容器时</span>
<span class="token comment"># (1) 没有使用-v或--mount时会自动创建匿名卷</span>
<span class="token comment"># (2) 使用—v或--mount时，目录不一致也会自动创建匿名卷，此时就相当于指定了多个卷</span>

<span class="token comment"># ---------------------------------------------------------------------------------------------------------</span>
<span class="token comment"># 匿名卷的使用</span>

<span class="token comment"># 先查看一下的当前的情况</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker image ls</span>
REPOSITORY                     TAG                 IMAGE ID       CREATED         SIZE
centos                         <span class="token number">7</span>                   eeb6ee3f44bd   <span class="token number">8</span> months ago    204MB
nginx                          <span class="token number">1.21</span>.6              7425d3a7c478   <span class="token number">8</span> days ago      142MB
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME

<span class="token comment"># 查看Dockerfile</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile </span>
FROM centos:7
MAINTAINER VVFock3r
WORKDIR /
VOLUME <span class="token punctuation">[</span><span class="token string">&quot;/data&quot;</span><span class="token punctuation">]</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">]</span>

<span class="token comment"># 构建镜像</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker build -t centos:main .</span>
Sending build context to Docker daemon  <span class="token number">16</span>.02MB
Step <span class="token number">1</span>/5 <span class="token builtin class-name">:</span> FROM centos:7
 ---<span class="token operator">&gt;</span> eeb6ee3f44bd
Step <span class="token number">2</span>/5 <span class="token builtin class-name">:</span> MAINTAINER VVFock3r
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> f7cea628e420
Step <span class="token number">3</span>/5 <span class="token builtin class-name">:</span> WORKDIR /
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> 07f0b2f933b5
Step <span class="token number">4</span>/5 <span class="token builtin class-name">:</span> VOLUME <span class="token punctuation">[</span><span class="token string">&quot;/data&quot;</span><span class="token punctuation">]</span>
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> 73570684b51d
Step <span class="token number">5</span>/5 <span class="token builtin class-name">:</span> CMD <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">]</span>
 ---<span class="token operator">&gt;</span> Using cache
 ---<span class="token operator">&gt;</span> 48ab01d4fcec
Successfully built 48ab01d4fcec
Successfully tagged centos:main
<span class="token comment"># 再查看一下VOLUME</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME

<span class="token comment"># 启动容器，不进行持久化</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -d --name main centos:main</span>

<span class="token comment"># 再查看一下VOLUME，发现已经自动创建了一个匿名卷，即自动进行了持久化</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     807798b92c720098345fb3d9629571bbb67c43d1712248ae45038722cca70a7c

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume inspect 807798b92c720098345fb3d9629571bbb67c43d1712248ae45038722cca70a7c</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;CreatedAt&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2022-05-19T19:50:03+08:00&quot;</span>,
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> null,
        <span class="token string">&quot;Mountpoint&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/807798b92c720098345fb3d9629571bbb67c43d1712248ae45038722cca70a7c/_data&quot;</span>,
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;807798b92c720098345fb3d9629571bbb67c43d1712248ae45038722cca70a7c&quot;</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> null,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment"># 查看一下容器信息</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect main | grep -i mounts -A 13</span>
        <span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;807798b92c720098345fb3d9629571bbb67c43d1712248ae45038722cca70a7c&quot;</span>,
                <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/807798b92c720098345fb3d9629571bbb67c43d1712248ae45038722cca70a7c/_data&quot;</span>,
                <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/data&quot;</span>,
                <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
                <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
                <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Hostname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;783eaeaeb92a&quot;</span>,
<span class="token comment"># ---------------------------------------------------------------------------------------------------------</span>
<span class="token comment"># 再启动一个容器，发现匿名卷又增加了一个</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -d --name main2 centos:main</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     0f6d8c19f62874b7e5f39653c36a67de5bbdc22f4ef516fbe00bef0d554ba05b
<span class="token builtin class-name">local</span>     807798b92c720098345fb3d9629571bbb67c43d1712248ae45038722cca70a7c

<span class="token comment"># ---------------------------------------------------------------------------------------------------------</span>
<span class="token comment"># 使用-v可以覆盖Dockerfile中的VOLUME指令</span>

<span class="token comment"># 启动一个容器，指定使用卷mydata（不存在时会自动创建）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -d --name main3 -v mydata:/data/ centos:main</span>

<span class="token comment"># 查看卷</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     0f6d8c19f62874b7e5f39653c36a67de5bbdc22f4ef516fbe00bef0d554ba05b
<span class="token builtin class-name">local</span>     807798b92c720098345fb3d9629571bbb67c43d1712248ae45038722cca70a7c
<span class="token builtin class-name">local</span>     mydata <span class="token comment"># 这个是自动创建的，匿名卷也没有增加，说明dockerfile中的VOLUME指令并没有生效</span>

<span class="token comment"># ---------------------------------------------------------------------------------------------------------</span>
<span class="token comment"># 使用-v时，当持久化容器的目录不一致时，不会进行覆盖</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run -d --name main4 -v mypkg:/pkg/ centos:main # /pkg/与镜像中的/data/不一致，两个卷都会创建</span>

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME
<span class="token builtin class-name">local</span>     0f6d8c19f62874b7e5f39653c36a67de5bbdc22f4ef516fbe00bef0d554ba05b	
<span class="token builtin class-name">local</span>     650d74ab0215307f165e07ff39bae4dfb10b6d32561cddec65c28dff207ffda4	<span class="token comment"># 自动创建的，用于持久化/data/</span>
<span class="token builtin class-name">local</span>     807798b92c720098345fb3d9629571bbb67c43d1712248ae45038722cca70a7c
<span class="token builtin class-name">local</span>     mydata
<span class="token builtin class-name">local</span>     mypkg	<span class="token comment"># 自动创建的，用于持久化/pkg/</span>


<span class="token comment"># 看一下容器持久化详情</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect main4 | grep -i mounts -A 20</span>
        <span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;mypkg&quot;</span>,
                <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/mypkg/_data&quot;</span>,
                <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/pkg&quot;</span>,
                <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
                <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;z&quot;</span>,
                <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
                <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>,
            <span class="token punctuation">{</span>
                <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;650d74ab0215307f165e07ff39bae4dfb10b6d32561cddec65c28dff207ffda4&quot;</span>,
                <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/650d74ab0215307f165e07ff39bae4dfb10b6d32561cddec65c28dff207ffda4/_data&quot;</span>,
                <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/data&quot;</span>,
                <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
                <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
                <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
</code></pre></div></details><h4 id="内存文件系统-tmpfs-mounts" tabindex="-1"><a class="header-anchor" href="#内存文件系统-tmpfs-mounts" aria-hidden="true">#</a> 内存文件系统：tmpfs mounts</h4><p>文档：<a href="https://docs.docker.com/storage/tmpfs/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/storage/tmpfs/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>容器的数据会放到宿主机内存中，当容器重启后数据清空</p><details class="custom-container details"><summary>tmpfs mounts基础操作</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 启动一个容器，容器的/data目录数据存在于宿主机内存中</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name mycentos -itd --mount type=tmpfs,dst=/data centos:7</span>

<span class="token comment"># 查看卷，并没有创建</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker volume ls</span>
DRIVER    VOLUME NAME

<span class="token comment"># 查看容器存储</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect mycentos | grep -i mounts -A 13</span>
            <span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;tmpfs&quot;</span>,
                    <span class="token string">&quot;Target&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/data&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>,
            <span class="token string">&quot;MaskedPaths&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;/proc/asound&quot;</span>,
                <span class="token string">&quot;/proc/acpi&quot;</span>,
                <span class="token string">&quot;/proc/kcore&quot;</span>,
                <span class="token string">&quot;/proc/keys&quot;</span>,
                <span class="token string">&quot;/proc/latency_stats&quot;</span>,
                <span class="token string">&quot;/proc/timer_list&quot;</span>,
                <span class="token string">&quot;/proc/timer_stats&quot;</span>,
--
        <span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;tmpfs&quot;</span>,
                <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/data&quot;</span>,
                <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
                <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
        <span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Hostname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;99d0d321bd5f&quot;</span>,
            <span class="token string">&quot;Domainname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
            <span class="token string">&quot;User&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
            
<span class="token comment"># 在容器/data中写点数据</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it mycentos /bin/bash</span>
<span class="token punctuation">[</span>root@99d0d321bd5f /<span class="token punctuation">]</span><span class="token comment"># cd /data</span>
<span class="token punctuation">[</span>root@99d0d321bd5f data<span class="token punctuation">]</span><span class="token comment"># seq 100 &gt; 1.txt</span>
<span class="token punctuation">[</span>root@99d0d321bd5f data<span class="token punctuation">]</span><span class="token comment"># exit</span>

<span class="token comment"># 重启容器，检查数据已经不存在了</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container restart mycentos</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it mycentos /bin/bash</span>
<span class="token punctuation">[</span>root@99d0d321bd5f /<span class="token punctuation">]</span><span class="token comment"># ls /data/</span>
<span class="token punctuation">[</span>root@99d0d321bd5f /<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre></div></details><h3 id="docker资源限制" tabindex="-1"><a class="header-anchor" href="#docker资源限制" aria-hidden="true">#</a> Docker资源限制</h3><p>文档：<a href="https://docs.docker.com/config/containers/resource_constraints/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/config/containers/resource_constraints/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>默认Docker是不限制容器所使用的内存、CPU等资源</p><h4 id="内存限制" tabindex="-1"><a class="header-anchor" href="#内存限制" aria-hidden="true">#</a> 内存限制</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>-m</code> or <code>--memory</code></td><td>容器可以使用的最大内存<br>如果设置此选项，则允许的最小值为6m（6 MB），也就是说，必须将该值设置为至少6 MB</td></tr><tr><td><code>--memory-swap</code></td><td>容器可以使用的最大交换分区</td></tr><tr><td><code>--memory-swappiness</code></td><td>当物理内存剩余N时就开始使用交换分区，可设置范围在0到100之间， 单位百分比<br>不设置此值则默认使用系统设置的值,一般为30（当剩余物理内存小于30%时开始使用交换分区）</td></tr><tr><td><code>--oom-kill-disable</code></td><td>禁用OOM Killer</td></tr></tbody></table><h4 id="cpu限制" tabindex="-1"><a class="header-anchor" href="#cpu限制" aria-hidden="true">#</a> CPU限制</h4><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td><code>--cpus</code></td><td>可使用的CPU核心数</td></tr><tr><td><code>--cpuset-cpus</code></td><td>限制容器使用特定的CPU核心，比如0-3,1等</td></tr><tr><td><code>--cpu-shares</code></td><td>CPU共享（相对权重）</td></tr></tbody></table><h3 id="docker网络" tabindex="-1"><a class="header-anchor" href="#docker网络" aria-hidden="true">#</a> Docker网络</h3><h4 id="docker自带的3种网络" tabindex="-1"><a class="header-anchor" href="#docker自带的3种网络" aria-hidden="true">#</a> Docker自带的3种网络</h4><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 通过如下命令可以查看Docker自带的3种基本网络，但实际上我们可用的并不仅仅是这3种，后面会一一介绍</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
aece42e0e44c   bridge    bridge    <span class="token builtin class-name">local</span>
db9a2c63802b   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
e05e046464f3   none      null      <span class="token builtin class-name">local</span>
</code></pre></div><h4 id="_1-none网络" tabindex="-1"><a class="header-anchor" href="#_1-none网络" aria-hidden="true">#</a> （1）none网络</h4><p>文档：<a href="https://docs.docker.com/network/none/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/network/none/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>none类型的网络只有一个回环接口lo，没有办法联网，封闭的网络能很好的保证容器的安全性</p><details class="custom-container details"><summary>点击查看详情</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 启动容器,设置网络类型为none</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo -itd --network=none busybox:1.34</span>

<span class="token comment"># 查看容器网络模式</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo | grep -i network</span>
            <span class="token string">&quot;NetworkMode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;none&quot;</span>, <span class="token comment"># 网络模式为none类型</span>
        <span class="token string">&quot;NetworkSettings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Networks&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;e05e046464f3b65349d7895ca9d365f03e5bf261a5e1e30ede561b80f8d2010e&quot;</span>,                    
                    
<span class="token comment"># 在容器中查看网络接口</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue qlen <span class="token number">1</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
</code></pre></div></details><h4 id="_2-host网络" tabindex="-1"><a class="header-anchor" href="#_2-host网络" aria-hidden="true">#</a> （2）host网络</h4><p>文档：<a href="https://docs.docker.com/network/host/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/network/host/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>host类型的网络和和宿主机共用一个<code>Network Namespace</code>，即<span style="color:red;font-weight:bold;">容器和宿主机的IP和端口等是共用的</span></p><details class="custom-container details"><summary>点击查看详情</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 启动容器,设置网络类型为host</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run --name demo -itd --network host busybox:1.34</span>

<span class="token comment"># 查看容器网络模式</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo | grep -i network</span>
            <span class="token string">&quot;NetworkMode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;host&quot;</span>,
        <span class="token string">&quot;NetworkSettings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Networks&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;db9a2c63802b71ff7c22f7c789415c0dc06f111de9db4e07c4ce13a45d47eea6&quot;</span>,
                    
<span class="token comment"># 在容器中查看网络接口，和宿主机输出一致</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue qlen <span class="token number">1</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span> 
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: ens33: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast qlen <span class="token number">1000</span>
    link/ether 00:0c:29:9b:05:4a brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.48.133/24 brd <span class="token number">192.168</span>.48.255 scope global dynamic ens33
       valid_lft 1010sec preferred_lft 1010sec
    inet6 fe80::10b3:d204:8d1d:93f7/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>NO-CARRIER,BROADCAST,MULTICAST,UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue 
    link/ether 02:42:c2:e3:1b:d5 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.1/16 brd <span class="token number">172.17</span>.255.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:c2ff:fee3:1bd5/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever

<span class="token comment"># ------------------------------------------------------------------------------------------------------------------</span>
<span class="token comment"># 在宿主机监听一个端口，然后进入容器继续监听此端口，发现端口已经被占用了</span>

<span class="token comment"># 宿主机监听10000端口</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># nc -l -v -p 10000</span>
Ncat: Version <span class="token number">7.50</span> <span class="token punctuation">(</span> https://nmap.org/ncat <span class="token punctuation">)</span>
Ncat: Listening on :::10000
Ncat: Listening on <span class="token number">0.0</span>.0.0:10000

<span class="token comment"># 进入容器，也监听10000端口，发现端口被占用</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo nc -l -v -p 10000</span>
nc: bind: Address already <span class="token keyword">in</span> use
</code></pre></div></details><h4 id="_3-container网络" tabindex="-1"><a class="header-anchor" href="#_3-container网络" aria-hidden="true">#</a> （3）container网络</h4><p>我们在启动容器时候，可以指定共享已存在的容器的网络</p><details class="custom-container details"><summary>container网络</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 启动一个容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo1 -itd busybox:1.34</span>

<span class="token comment"># 再启动一个容器，通过--network container:demo1参数，指定共享demo1容器的网络</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo2 -itd --network container:demo1 busybox:1.34</span>

<span class="token comment"># 分别查看两个容器的IP，发现是一样的</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo1 ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue qlen <span class="token number">1</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">30</span>: eth0@if31: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0  <span class="token comment"># IP：172.17.0.2/16</span>
       valid_lft forever preferred_lft forever

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo2 ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue qlen <span class="token number">1</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">30</span>: eth0@if31: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0	 <span class="token comment"># IP：172.17.0.2/16</span>
       valid_lft forever preferred_lft forever
</code></pre></div></details><h4 id="_4-1-默认bridge网络" tabindex="-1"><a class="header-anchor" href="#_4-1-默认bridge网络" aria-hidden="true">#</a> （4-1）默认bridge网络</h4><p>文档：<a href="https://docs.docker.com/network/bridge/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/network/bridge/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>Docker进程启动时，会在主机上创建一个名为<code>docker0</code>的虚拟网桥，此主机上启动的Docker容器会连接到这个虚拟网桥上。 虚拟网桥的工作方式和物理交换机类似，这样主机上的所有容器就通过交换机连在了一个二层网络中</p><br><p><code>bridge</code>是创建容器时docker默认网络，相同bridge下的容器可以互相通信，不同bridge下的容器不能通信</p><br><p>创建容器bridge网络的流程</p><ol><li><p>在宿主机上创建一对虚拟网卡veth pair设备</p></li><li><p>Docker将veth pair设备的一端放在新创建的容器中，并命名为eth0；</p><p>Docker将另一端放在主机中，以veth*这样类似的名字命名，并将这个网络设备加入到docker0网桥中</p></li><li><p>从<code>docker0</code>子网中分配一个IP给容器使用，并设置docker0的IP地址为容器的默认网关</p></li></ol><br><details class="custom-container details"><summary>相关命令简介</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># yum install -y bridge-utils</span>

<span class="token comment"># 查看docker自带的3种网络</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
e47d2b8de53b   bridge    bridge    <span class="token builtin class-name">local</span>
db9a2c63802b   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
e05e046464f3   none      null      <span class="token builtin class-name">local</span>

<span class="token comment"># 查看网桥详情（包含子网和链接的容器等）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network inspect bridge</span>
		<span class="token comment"># 子网信息</span>
        <span class="token string">&quot;IPAM&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;default&quot;</span>,
            <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> null,
            <span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;Subnet&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.0/16&quot;</span>,	<span class="token comment"># 子网地址</span>
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.1&quot;</span>		<span class="token comment"># 默认网关</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        
        <span class="token comment"># 链接的容器</span>
        <span class="token string">&quot;Containers&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>            
        <span class="token punctuation">}</span>,
        

<span class="token comment"># 查看系统上的网桥列表</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># brctl show</span>
bridge name     bridge <span class="token function">id</span>               STP enabled     interfaces
docker0         <span class="token number">8000</span>.024259017b71       no

<span class="token comment"># 在宿主机上和容器种查看veth设备</span>
使用ifconfig、ip a或ip <span class="token function">link</span> list等命令
</code></pre></div></details><details class="custom-container details"><summary>（0）准备工作：创建两个容器，分别使用默认网络和指定bridge网络</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 创建两个容器，一个使用默认的网络，一个指定使用bridge</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run -itd --name demo1 busybox:1.34</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run -itd --name demo2 --network bridge busybox:1.34</span>
</code></pre></div></details><details class="custom-container details"><summary>（1）docker中的网桥和Linux上的网桥对应关系</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># Linux上的bridge列表</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># brctl show</span>
bridge name     		bridge <span class="token function">id</span>               STP enabled     interfaces
docker0         		<span class="token number">8000</span>.0242dad030cf       no

<span class="token comment"># Docker中的bridge，对应Linux bridge的docker0</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network inspect bridge | grep bridge.name</span>
            <span class="token string">&quot;com.docker.network.bridge.name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;docker0&quot;</span>,
</code></pre></div></details><details class="custom-container details"><summary>（2）查看默认网桥</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 没有找到明显的依据，只能检查一下有没有显示配置默认网桥是啥来判断</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/docker/daemon.json</span>
<span class="token punctuation">{</span>
   <span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;https://6xumug9e.mirror.aliyuncs.com&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></details><details class="custom-container details"><summary>（3）网桥和容器的对应关系</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># Linux角度来看，的docker0网桥下包含2对veth设置</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># brctl show</span>
bridge name     bridge <span class="token function">id</span>               STP enabled     interfaces
docker0         <span class="token number">8000</span>.024259017b71       no              veth2df3118
                                                        vethd035852
<span class="token comment"># Docker角度来看，的默认网桥bridge下包含2个容器</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network inspect bridge | grep -i containers -A 15</span>
        <span class="token string">&quot;Containers&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;6f54d26719d9e45e3a157998607994c29f09ec20a316d1d93ecc700d2fc45065&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;demo1&quot;</span>,	<span class="token comment"># 容器名</span>
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;9d431e06472f77fed976acb927be1d38540fe25d114ee4e7daca7f15d527bd65&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:ac:11:00:02&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.2/16&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>,
            <span class="token string">&quot;be042630a0f8755c713aa29faaa74f7321246b5fd9e9cd96ce7d3a10c011238d&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;demo2&quot;</span>,	<span class="token comment"># 容器名</span>
                <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;828bb4005aea51445d236b23a7c13df2cf900d551debb2ae1f4f32a15b9ba0d6&quot;</span>,
                <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:ac:11:00:03&quot;</span>,
                <span class="token string">&quot;IPv4Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.3/16&quot;</span>,
                <span class="token string">&quot;IPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>,
        
<span class="token comment"># 从容器角度来看所使用的网桥</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo1 | grep -i network</span>
			<span class="token comment"># 默认网桥，一般来说默认是bridge，但也可以手动指定默认网桥，所以这里并不能说明一定是bridge，还需要检查默认网桥具体是啥</span>
            <span class="token string">&quot;NetworkMode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;default&quot;</span>,
        <span class="token string">&quot;NetworkSettings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Networks&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;e47d2b8de53b2f7f989125a7f7362d15c4185189a6ef91900f8b08311a9676c0&quot;</span>,
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo2 | grep -i network</span>
            <span class="token string">&quot;NetworkMode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bridge&quot;</span>,	<span class="token comment"># 名为bridge的网桥</span>
        <span class="token string">&quot;NetworkSettings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Networks&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;e47d2b8de53b2f7f989125a7f7362d15c4185189a6ef91900f8b08311a9676c0&quot;</span>,
</code></pre></div></details><details class="custom-container details"><summary>（4）宿主机上的veth pair设备和容器中的veth pair设备对应关系</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 在宿主机上查看veth设备</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span> 
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: ens33: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP qlen <span class="token number">1000</span>
    link/ether 00:0c:29:9b:05:4a brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.48.133/24 brd <span class="token number">192.168</span>.48.255 scope global dynamic ens33
       valid_lft 1167sec preferred_lft 1167sec
    inet6 fe80::10b3:d204:8d1d:93f7/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP 
    link/ether 02:42:59:01:7b:71 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.1/16 brd <span class="token number">172.17</span>.255.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:59ff:fe01:7b71/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever

<span class="token number">9</span>: veth8041554@if8: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP <span class="token comment"># 这里9和8是一对veth pair设备</span>
    link/ether <span class="token number">12</span>:ca:18:5f:16:66 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet6 fe80::10ca:18ff:fe5f:1666/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever

<span class="token number">11</span>: veth2df3118@if10: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP<span class="token comment"># 这里11和10是一对veth pair设备</span>
    link/ether aa:3a:c5:72:77:81 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">1</span>
    inet6 fe80::a83a:c5ff:fe72:7781/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
        
<span class="token comment"># 在容器中查看veth设备</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo1 ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue qlen <span class="token number">1</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">8</span>: eth0@if9: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue 	<span class="token comment"># 8和9是一对veth pair设备，正好可以对应上</span>
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.2/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo2 ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue qlen <span class="token number">1</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">10</span>: eth0@if11: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue 	<span class="token comment"># 10和11是一对veth pair设备，正好可以对应上</span>
    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.3/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
</code></pre></div></details><h4 id="_4-2-自定义bridge网络" tabindex="-1"><a class="header-anchor" href="#_4-2-自定义bridge网络" aria-hidden="true">#</a> （4-2）自定义bridge网络</h4><p>文档：<a href="https://docs.docker.com/network/bridge/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/network/bridge/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>默认的网桥（bridge）并不推荐在生产环境中使用，因为存在一些技术缺陷，更好的方式是使用用户自定义bridge网络</p><details class="custom-container details"><summary>（1）创建自定义bridge网络</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 从Docker角度，看一下当前的网络</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
e47d2b8de53b   bridge    bridge    <span class="token builtin class-name">local</span>
db9a2c63802b   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
e05e046464f3   none      null      <span class="token builtin class-name">local</span>

<span class="token comment"># 从Linux角度，看一下当前的网络</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># brctl show</span>
bridge name     bridge <span class="token function">id</span>               STP enabled     interfaces
docker0         <span class="token number">8000</span>.024259017b71       no

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span> 
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: ens33: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP qlen <span class="token number">1000</span>
    link/ether 00:0c:29:9b:05:4a brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.48.133/24 brd <span class="token number">192.168</span>.48.255 scope global dynamic ens33
       valid_lft 1446sec preferred_lft 1446sec
    inet6 fe80::10b3:d204:8d1d:93f7/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>NO-CARRIER,BROADCAST,MULTICAST,UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state DOWN 
    link/ether 02:42:59:01:7b:71 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.1/16 brd <span class="token number">172.17</span>.255.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:59ff:fe01:7b71/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever

<span class="token comment"># 创建一个自定义的网络，网络驱动为bridge，子网172.20.0.0/16，默认网关172.20.0.1</span>
<span class="token comment"># Linux网桥名字默认是br-xx，如果想要指定的话添加参数 -o com.docker.network.bridge.name=自定义Linux网桥名</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network create --driver bridge --subnet 172.20.0.0/16 --gateway 172.20.0.1 bridge2</span>

<span class="token comment"># 从Docker角度，看一下当前的网络,发现多了一个</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
e47d2b8de53b   bridge    bridge    <span class="token builtin class-name">local</span>
8f855e175a4a   bridge2   bridge    <span class="token builtin class-name">local</span>	<span class="token comment"># 我们自定义的bridge网络，名字叫做bridge2</span>
db9a2c63802b   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
e05e046464f3   none      null      <span class="token builtin class-name">local</span>

<span class="token comment"># 从Linux角度，看一下当前的网络</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># brctl show</span>
bridge name     	bridge <span class="token function">id</span>               STP enabled     interfaces
br-4ead021696e6     <span class="token number">8000</span>.02422504f2ac       no		<span class="token comment"># 我们自定义的bridge网络，在Linux层面名字叫做br-4ead021696e6</span>
docker0         	<span class="token number">8000</span>.024259017b71       no

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span> 
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: ens33: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP qlen <span class="token number">1000</span>
    link/ether 00:0c:29:9b:05:4a brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.48.133/24 brd <span class="token number">192.168</span>.48.255 scope global dynamic ens33
       valid_lft 1192sec preferred_lft 1192sec
    inet6 fe80::10b3:d204:8d1d:93f7/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>NO-CARRIER,BROADCAST,MULTICAST,UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state DOWN 
    link/ether 02:42:59:01:7b:71 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.1/16 brd <span class="token number">172.17</span>.255.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:59ff:fe01:7b71/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">23</span>: br-4ead021696e6: <span class="token operator">&lt;</span>NO-CARRIER,BROADCAST,MULTICAST,UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state DOWN 	<span class="token comment"># 我们自定义的bridge网络</span>
    link/ether 02:42:25:04:f2:ac brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.20</span>.0.1/16 brd <span class="token number">172.20</span>.255.255 scope global br-4ead021696e6
       valid_lft forever preferred_lft forever


<span class="token comment"># 查看bridge2详情</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network inspect bridge2</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bridge2&quot;</span>,
        <span class="token string">&quot;Id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;4ead021696e67558a4d89ee6dd1cdc0fdf96a4558a604eaaf276591fcb8951a0&quot;</span>,
        <span class="token string">&quot;Created&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2022-05-21T14:18:15.033409735+08:00&quot;</span>,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bridge&quot;</span>,
        <span class="token string">&quot;EnableIPv6&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;IPAM&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;default&quot;</span>,
            <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
            <span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;Subnet&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.20.0.0/16&quot;</span>,
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.20.0.1&quot;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;Internal&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Attachable&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Ingress&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;ConfigFrom&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Network&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;ConfigOnly&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Containers&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div></details><details class="custom-container details"><summary>（2）使用自定义bridge网络</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 创建容器，使用自定义的bridge网络：bridge2</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo -itd --network bridge2 busybox:1.34</span>

<span class="token comment"># 查看IP和默认网关</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue qlen <span class="token number">1</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">26</span>: eth0@if27: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue 
    link/ether 02:42:ac:14:00:02 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.20</span>.0.2/16 brd <span class="token number">172.20</span>.255.255 scope global eth0		<span class="token comment"># IP：172.20.0.2</span>
       valid_lft forever preferred_lft forever
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo route -n</span>
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
<span class="token number">0.0</span>.0.0         <span class="token number">172.20</span>.0.1      <span class="token number">0.0</span>.0.0         UG    <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0	<span class="token comment"># 默认网关：172.20.0.1</span>
<span class="token number">172.20</span>.0.0      <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.0.0     U     <span class="token number">0</span>      <span class="token number">0</span>        <span class="token number">0</span> eth0
</code></pre></div></details><h4 id="_4-3-自定义bridge与默认的区别" tabindex="-1"><a class="header-anchor" href="#_4-3-自定义bridge与默认的区别" aria-hidden="true">#</a> （4-3）自定义bridge与默认的区别</h4><p>文档：<a href="https://docs.docker.com/network/bridge/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/network/bridge/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><details class="custom-container details"><summary>（1）自定义bridge网络支持DNS通信（容器名称或网络别名），而默认bridge不支持</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># ----------------------------------------------------------------------------------</span>
<span class="token comment"># 默认bridge不可以使用容器名称来进行通信</span>

<span class="token comment"># 启动2个容器，使用默认bridge</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo1 -itd busybox:1.34</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo2 -itd busybox:1.34</span>

<span class="token comment"># 查看他们的IP</span>
<span class="token comment"># 也可以使用其他方式查看IP，道理是一样的，比如：docker container exec -it demo2 ip a</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo1 -f &quot;{{ .NetworkSettings.IPAddress }}&quot;  </span>
<span class="token number">172.17</span>.0.2
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo2 -f &quot;{{ .NetworkSettings.IPAddress }}&quot;</span>
<span class="token number">172.17</span>.0.3

<span class="token comment"># 使用IP通信，没问题</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo1 ping -c 3 172.17.0.3</span>
PING <span class="token number">172.17</span>.0.3 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.3<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.210</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.072</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.090</span> ms
--- <span class="token number">172.17</span>.0.3 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">0.072</span>/0.124/0.210 ms

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo2 ping -c 3 172.17.0.2</span>
PING <span class="token number">172.17</span>.0.2 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.2<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.156</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.075</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.123</span> ms
--- <span class="token number">172.17</span>.0.2 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">0.075</span>/0.118/0.156 ms

<span class="token comment"># 使用容器名通信，网络不同</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo1 ping -c 3 demo2</span>
ping: bad address <span class="token string">&#39;demo2&#39;</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo2 ping -c 3 demo1</span>
ping: bad address <span class="token string">&#39;demo1&#39;</span>

<span class="token comment"># ----------------------------------------------------------------------------------</span>
<span class="token comment"># 自定义bridge可以使用容器名称或网络别名来进行通信</span>

<span class="token comment"># 启动2个容器，指定使用自定义bridge网络，bridge2我们之前已经创建过了</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo3 -itd --network bridge2 --network-alias demo33 busybox:1.34</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo4 -itd --network bridge2 --network-alias demo44 busybox:1.34</span>

<span class="token comment"># 查看他们的IP，注意这里查看的地方变化了</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo3 -f &quot;{{ .NetworkSettings.Networks.bridge2.IPAddress }}&quot;  </span>
<span class="token number">172.20</span>.0.2
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo4 -f &quot;{{ .NetworkSettings.Networks.bridge2.IPAddress }}&quot;  </span>
<span class="token number">172.20</span>.0.3

<span class="token comment"># 通过容器名来测试连通性</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo3 ping -c 3 demo4</span>
PING demo4 <span class="token punctuation">(</span><span class="token number">172.20</span>.0.3<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">172.20</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.058</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.20</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.068</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.20</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.083</span> ms
--- demo4 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">0.058</span>/0.069/0.083 ms

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo4 ping -c 3 demo3</span>
PING demo3 <span class="token punctuation">(</span><span class="token number">172.20</span>.0.2<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">172.20</span>.0.2: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.073</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.20</span>.0.2: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.085</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.20</span>.0.2: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.069</span> ms
--- demo3 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">0.069</span>/0.075/0.085 ms

<span class="token comment"># 通过网络别名来测试连通性</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo3 ping -c 3 demo44</span>
PING demo44 <span class="token punctuation">(</span><span class="token number">172.20</span>.0.3<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">172.20</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.072</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.20</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.071</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.20</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.067</span> ms
--- demo44 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">0.067</span>/0.070/0.072 ms

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec -it demo4 ping -c 3 demo33</span>
PING demo33 <span class="token punctuation">(</span><span class="token number">172.20</span>.0.2<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">172.20</span>.0.2: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.075</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.20</span>.0.2: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.071</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.20</span>.0.2: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.069</span> ms
--- demo33 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">0.069</span>/0.071/0.075 ms
</code></pre></div></details><details class="custom-container details"><summary>（2）自定义bridge网络支持设置容器静态IP，而默认bridge不支持</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 查看默认网桥bridge和自定义网桥bridge2的网段</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network inspect bridge | grep -i Subnet</span>
                    <span class="token string">&quot;Subnet&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.0/16&quot;</span>,
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network inspect bridge2 | grep -i Subnet</span>
                    <span class="token string">&quot;Subnet&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.20.0.0/16&quot;</span>,

<span class="token comment"># -----------------------------------------------------------------------------------------------------------</span>
<span class="token comment"># 默认网桥指定静态IP</span>
<span class="token comment"># （1）指定network为bridge时直接报错</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo1 --network bridge --ip 172.17.0.100 -itd busybox:1.34</span>
9acc8de3a1586afbe6ccaf794f1c0361250c0c0e298f24a586e6d3e1a19717e9
docker: Error response from daemon: user specified IP address is supported on user defined networks only.

<span class="token comment"># （2）不指定时不会报错，但是并没有分配我们指定的静态IP</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo1 --ip 172.17.0.100 -itd busybox:1.34</span>
a0805b036165408cbdeabbfaa21b110df42cf994df2e19b9d3b03fe922352596

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo1 -f &quot;{{ .NetworkSettings.Networks.bridge.IPAddress }}&quot;</span>
<span class="token number">172.17</span>.0.2

<span class="token comment"># -----------------------------------------------------------------------------------------------------------</span>
<span class="token comment"># 自定义网桥指定静态IP</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo2 --network bridge2 --ip 172.20.0.100 -itd busybox:1.34</span>
1f76c49de62a70d664d73608541689d4ad75d746f9a59e8415386e258435a7b9

<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo2 -f &quot;{{ .NetworkSettings.Networks.bridge2.IPAddress }}&quot;</span>
<span class="token number">172.20</span>.0.100
</code></pre></div></details><h4 id="_4-4-不同bridge下的容器互通" tabindex="-1"><a class="header-anchor" href="#_4-4-不同bridge下的容器互通" aria-hidden="true">#</a> （4-4）不同bridge下的容器互通</h4><details class="custom-container details"><summary>不同bridge下的容器互通</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 创建两个容器，分别属于不同的网桥</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo1 --network bridge  -itd busybox:1.34</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container run --name demo2 --network bridge2 -itd busybox:1.34</span>

<span class="token comment"># 查看两个容器的IP</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo1 -f &quot;{{ .NetworkSettings.Networks.bridge.IPAddress }}&quot;</span>
<span class="token number">172.17</span>.0.2
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo2 -f &quot;{{ .NetworkSettings.Networks.bridge2.IPAddress }}&quot;</span>
<span class="token number">172.20</span>.0.2

<span class="token comment"># 不同的bridge下的容器是不能通信的</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec demo1 ping -c 3 172.20.0.2</span>
PING <span class="token number">172.20</span>.0.2 <span class="token punctuation">(</span><span class="token number">172.20</span>.0.2<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
--- <span class="token number">172.20</span>.0.2 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">0</span> packets received, <span class="token number">100</span>% packet loss

<span class="token comment"># 将demo2加入到demo1所在的网桥中，新的网桥会给demo2分配一个新的IP</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network connect bridge demo2</span>

<span class="token comment"># 查看demo2的网络信息</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container inspect demo2 -f &quot;{{ json .NetworkSettings.Networks }}&quot; | jq</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;bridge&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;IPAMConfig&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
    <span class="token string">&quot;Links&quot;</span><span class="token builtin class-name">:</span> null,
    <span class="token string">&quot;Aliases&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
    <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;cc4b3794a3f6c4a5a13e4230f10569e3d9c4056774f6e0eb77384b95a8a95fdf&quot;</span>,
    <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;879bd066516d7436eec9a978c350d71146795594c34916cf5d66bd9df51f78c9&quot;</span>,
    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.1&quot;</span>,
    <span class="token string">&quot;IPAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.3&quot;</span>,		<span class="token comment"># bridge网桥分配的IP</span>
    <span class="token string">&quot;IPPrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,
    <span class="token string">&quot;IPv6Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
    <span class="token string">&quot;GlobalIPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
    <span class="token string">&quot;GlobalIPv6PrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:ac:11:00:03&quot;</span>,
    <span class="token string">&quot;DriverOpts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;bridge2&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;IPAMConfig&quot;</span><span class="token builtin class-name">:</span> null,
    <span class="token string">&quot;Links&quot;</span><span class="token builtin class-name">:</span> null,
    <span class="token string">&quot;Aliases&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;2e7375c5c76a&quot;</span>
    <span class="token punctuation">]</span>,
    <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;4ead021696e67558a4d89ee6dd1cdc0fdf96a4558a604eaaf276591fcb8951a0&quot;</span>,
    <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ee6cd43fb03ac3118cfe787a7ae8eb74166b1c4133829cb54d3d5c47310dfde3&quot;</span>,
    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.20.0.1&quot;</span>,
    <span class="token string">&quot;IPAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.20.0.2&quot;</span>,
    <span class="token string">&quot;IPPrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,
    <span class="token string">&quot;IPv6Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
    <span class="token string">&quot;GlobalIPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
    <span class="token string">&quot;GlobalIPv6PrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:ac:14:00:02&quot;</span>,
    <span class="token string">&quot;DriverOpts&quot;</span><span class="token builtin class-name">:</span> null
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment"># 通信测试</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec demo1 ping -c 3 172.17.0.3</span>
PING <span class="token number">172.17</span>.0.3 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.3<span class="token punctuation">)</span>: <span class="token number">56</span> data bytes
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.087</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.081</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.3: <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.114</span> ms
--- <span class="token number">172.17</span>.0.3 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> packets received, <span class="token number">0</span>% packet loss
round-trip min/avg/max <span class="token operator">=</span> <span class="token number">0.081</span>/0.094/0.114 ms

<span class="token comment"># 查看demo2容器，本质就是分配了两块网卡</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker container exec demo2 ip a </span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">26</span>: eth0@if27: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue 
    link/ether 02:42:ac:14:00:02 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.20</span>.0.2/16 brd <span class="token number">172.20</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
<span class="token number">28</span>: eth1@if29: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue 
    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.3/16 brd <span class="token number">172.17</span>.255.255 scope global eth1
       valid_lft forever preferred_lft forever
</code></pre></div></details><h4 id="_4-5-修改默认的bridge" tabindex="-1"><a class="header-anchor" href="#_4-5-修改默认的bridge" aria-hidden="true">#</a> （4-5）修改默认的bridge</h4><p>文档：<a href="https://docs.docker.com/network/bridge/#configure-the-default-bridge-network" target="_blank" rel="noopener noreferrer">https://docs.docker.com/network/bridge/#configure-the-default-bridge-network<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>需要说明的是：</p><p>（1）从docker角度看默认的网桥是<code>bridge</code>，从Linux角度看默认的网桥是<code>docker0</code>，他俩是一个东西</p><p>（2）假设我们有两个网桥<code>docker0</code>和<code>docker1</code>，我们想让docker1作为默认网桥，这是不可以的，默认的网桥必须是<code>docker0</code>，原因是：</p><ul><li><p><code>bridge</code>是不允许删除的</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network rm bridge</span>
Error response from daemon: bridge is a pre-defined network and cannot be removed
</code></pre></div></li><li><p><code>bridge</code>对应的Linux网桥是<code>docker0</code></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network inspect bridge | grep bridge.name</span>
            <span class="token string">&quot;com.docker.network.bridge.name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;docker0&quot;</span>,
</code></pre></div></li><li><p><code>docker0</code>是可以被删除的，但是在启动docker的时候会重新创建<code>docker0</code></p><details class="custom-container details"><summary>点击查看详情</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 删除docker0网桥</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># ip link set dev docker0 down</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># brctl delbr docker0</span>

<span class="token comment"># 查看网桥列表</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># brctl show</span>
bridge name     bridge <span class="token function">id</span>               STP enabled     interfaces

<span class="token comment"># 查看docker bridge网桥（没有变化）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
70cd27ddf376   bridge    bridge    <span class="token builtin class-name">local</span>
db9a2c63802b   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
e05e046464f3   none      null      <span class="token builtin class-name">local</span>

<span class="token comment"># 创建容器会失败（底层网桥都没了）</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run --rm -itd centos:7</span>
5d5bb734fa70390564b43764b22c0348a66ec9c7252ab3fff24338ee550b989f
docker: Error response from daemon: failed to create endpoint pedantic_poitras on network bridge: adding interface veth954f245 to bridge docker0 failed: could not <span class="token function">find</span> bridge docker0: route ip+net: no such network interface.

<span class="token comment"># 重启Docker</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker.service</span>

<span class="token comment"># 查看Linux网桥</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># brctl show</span>
bridge name     bridge <span class="token function">id</span>               STP enabled     interfaces
docker0         <span class="token number">8000</span>.02426f6d6288       no

<span class="token comment"># 创建容器没问题</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker run --rm -itd centos:7</span>
284d036ab36a1ec02da91f11dda590ae72c5fabfd35cb2ecb1d792109ab02e3e
</code></pre></div></details></li></ul><p>（3）我们修改默认网桥，其实是对<code>docker0</code>做一些配置，比如定义子网等</p><details class="custom-container details"><summary>修改子网和默认网关</summary><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 修改daemon.json文件</span>
<span class="token punctuation">[</span>root@localhost _data<span class="token punctuation">]</span><span class="token comment"># vim /etc/docker/daemon.json </span>
<span class="token punctuation">{</span>
   <span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;https://6xumug9e.mirror.aliyuncs.com&quot;</span>
  <span class="token punctuation">]</span>,						<span class="token comment"># 这里使用逗号分隔多个字段</span>
 <span class="token string">&quot;bip&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.1.1/24&quot;</span>    <span class="token comment"># 注意json文件末尾不能有逗号</span>
<span class="token punctuation">}</span>

<span class="token comment"># 重启docker</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker.service</span>

<span class="token comment"># 查看默认网桥bridge的子网</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker network inspect bridge</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bridge&quot;</span>,
        <span class="token string">&quot;Id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;27388f5b5aafb240f1c0a84f4017eae04a96de8af5416e8fd912e8be54866cdb&quot;</span>,
        <span class="token string">&quot;Created&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2022-05-26T15:03:20.113023733+08:00&quot;</span>,
        <span class="token string">&quot;Scope&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
        <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bridge&quot;</span>,
        <span class="token string">&quot;EnableIPv6&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;IPAM&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;default&quot;</span>,
            <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> null,
            <span class="token string">&quot;Config&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token string">&quot;Subnet&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.1.0/24&quot;</span>,		<span class="token comment"># 子网已经修改</span>
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;192.168.1.1&quot;</span>		<span class="token comment"># 默认网关也修改了</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;Internal&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Attachable&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Ingress&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;ConfigFrom&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;Network&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;ConfigOnly&quot;</span><span class="token builtin class-name">:</span> false,
        <span class="token string">&quot;Containers&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>,
        <span class="token string">&quot;Options&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;com.docker.network.bridge.default_bridge&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;true&quot;</span>,
            <span class="token string">&quot;com.docker.network.bridge.enable_icc&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;true&quot;</span>,
            <span class="token string">&quot;com.docker.network.bridge.enable_ip_masquerade&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;true&quot;</span>,
            <span class="token string">&quot;com.docker.network.bridge.host_binding_ipv4&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0.0.0.0&quot;</span>,
            <span class="token string">&quot;com.docker.network.bridge.name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;docker0&quot;</span>,
            <span class="token string">&quot;com.docker.network.driver.mtu&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1500&quot;</span>
        <span class="token punctuation">}</span>,
        <span class="token string">&quot;Labels&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div></details></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1265921100@qq.com">yujinhui</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.8347a01d.js" defer></script>
  </body>
</html>
